<!DOCTYPE html>
<html lang="en">
<head>
    <style>
       html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;            /* no browser scrollbars */
}

        #main-wrapper {
            width: 75vw;
            max-width: 1000px;
            margin: 0 auto;
            height: 95vh;
            overflow-y: auto;
            box-sizing: border-box;
            padding: 1rem;
        }
    </style>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden; /* Prevent horizontal scrollbars only */
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        /* Main container optimized for full viewport */
        .main-container {
            width: 100vw;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            box-sizing: border-box;
        }

        .content-wrapper {
            width: 100%;
            max-width: 1400px;
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }
    </style>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>
        Chi-Square Distribution Calculator
    </title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/annotations.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
    
    <!-- Common Calculator Styles -->
    <link href="calculator-common.css" rel="stylesheet"/>
    <style>
        :root {
            --surface-0: #0c1624; /* page background */
            --surface-1: #1a1f2e; /* cards / panels - warmer dark gray-blue */
            --surface-2: #242938; /* chart / results boxes */
            --border: #2d3748; /* softer border color */
            --accent-1: rgb(255,165,120); /* warm orange */
            --accent-2: rgb(120,200,255); /* cyan blue */
            --text-primary: #ffffff;
            --text-secondary: rgba(255,255,255,0.8);
            --text-muted: rgba(255,255,255,0.6);
            --panel-bg: var(--surface-1);
            --panel-radius: 10px;
            --panel-shadow: 0px 4px 20px rgba(0, 0, 0, 0.4);
            --header-bg: var(--surface-0);
            --header-color: var(--accent-1);
            --highlight-bg: rgba(255, 165, 120, 0.2);
            --highlight-text: var(--accent-1);
            --primary-blue: var(--accent-1);
            --primary-blue-hover: rgb(230,140,90);
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
            --pad: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--surface-0);
            color: var(--text-primary);
        }

        #main-wrapper {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .main-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-wrapper {
            flex: 1;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            height: 100%;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--header-bg) 0%, #1a1a2e 100%);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--header-color);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            color: #bbb;
            font-size: 1.1rem;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            flex: 1;
            min-height: 0;
        }

        .control-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 25px;
            height: fit-content;
        }

        .visualization-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .panel-title {
            font-size: 1.4rem;
            color: var(--header-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #e8e8e8;
            font-size: 0.9rem;
        }

        .input-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 10px;
            border: 2px solid #555;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 0.9rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .input-field.updating {
            border-color: var(--primary-blue);
            background: rgba(52, 152, 219, 0.1);
            box-shadow: 0 0 12px rgba(52, 152, 219, 0.4);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #2c3e50 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-blue-hover) 0%, #34495e 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green) 0%, #16a085 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #2ecc71 0%, #17a2b8 100%);
            transform: translateY(-2px);
        }

        .calculation-type {
            margin-bottom: 25px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #555;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
        }

        .radio-option:hover {
            border-color: var(--primary-blue);
            background: rgba(52, 152, 219, 0.1);
        }

        .radio-option input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--primary-blue);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .radio-option.selected {
            border-color: var(--header-color);
            background: var(--highlight-bg);
        }

        .radio-option.selected.quantile-mode {
            border-color: rgb(255,165,120);
            background: rgba(52, 152, 219, 0.2);
        }

        .results-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 25px;
            margin-top: 30px;
        }

        .result-card {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--header-color);
        }

        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--header-color);
            margin-bottom: 5px;
        }

        .result-label {
            color: #bbb;
            font-size: 0.95rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        /* Combined Tabs and Options Row */
        .tabs-and-options-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }

        .tabs {
            display: flex;
            margin-bottom: 0;
            border-bottom: none;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #bbb;
            position: relative;
            overflow: hidden;
        }

        .tab:hover {
            color: white;
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .tab.active {
            color: var(--header-color);
            border-bottom-color: var(--header-color);
            background: rgba(255,165,120,0.1);
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(255,165,120,0.3);
        }

        .tab.switching {
            animation: tabSwitchPulse 0.8s ease;
        }

        @keyframes tabSwitchPulse {
            0% {
                transform: translateY(0);
                box-shadow: 0 4px 12px rgba(255,165,120,0.3);
            }
            50% {
                transform: translateY(-4px);
                box-shadow: 0 8px 24px rgba(255,165,120,0.5);
            }
            100% {
                transform: translateY(0);
                box-shadow: 0 4px 12px rgba(255,165,120,0.3);
            }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--header-color);
        }

        .stat-label {
            color: #bbb;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .probability-visualization {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .shaded-area-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,165,120,0.1);
            border-radius: 6px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
        }

        .shaded-area-info.updating {
            background: rgba(52, 152, 219, 0.15);
            border: 1px solid rgba(52, 152, 219, 0.3);
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.2);
        }

        .shaded-area-info.quantile-mode {
            background: rgba(52, 152, 219, 0.15);
            border: 1px solid rgba(52, 152, 219, 0.4);
        }

        .shaded-area-info.quantile-mode #equationText,
        .shaded-area-info.quantile-mode #percentageText {
            color: rgb(255,165,120);
        }

        .shaded-area-info.quantile-mode #percentageText {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .chart-container {
            flex: 1 1 auto;
            min-height: 200px;
            max-height: 60vh;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .input-row {
                flex-direction: column;
                gap: 8px;
            }
        }

        @media (max-width: 768px) {
            html, body {
                overflow-x: hidden;
                overflow-y: auto;
                height: auto;
                min-height: 100vh;
            }

            .main-container {
                height: auto;
                min-height: 100vh;
                align-items: flex-start;
            }

            .content-wrapper {
                height: auto;
                min-height: auto;
            }

            .container {
                padding: 10px;
                height: auto;
                min-height: 100vh;
                overflow: visible;
            }

            .main-content {
                display: flex;
                flex-direction: column;
                height: auto;
                min-height: 0;
                gap: 15px;
            }

            .visualization-panel {
                overflow-y: auto;
                max-height: none;
                height: auto;
                min-height: 600px;
            }

            .chart-container {
                width: 100%;
                height: 400px !important;
                min-height: 400px !important;
                max-height: none;
                overflow: visible;
                position: relative;
            }

            .chart-container > div {
                width: 100% !important;
                height: 100% !important;
            }

            /* Hide plot line labels on mobile to prevent overlap */
            .highcharts-plot-line-label {
                display: none !important;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs-and-options-row {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .chart-options-toolbar {
                justify-content: center;
                gap: 10px;
                flex-wrap: wrap;
            }

            .results-row {
                flex-direction: column;
                gap: 10px;
            }

            .about-content {
                margin: 15px;
                padding: 15px;
                max-width: calc(100% - 30px);
                max-height: 90vh;
            }

            .about-title {
                font-size: 1.3rem;
            }

            .applications-grid {
                grid-template-columns: 1fr;
            }

            .tooltip {
                max-width: 200px;
                font-size: 0.75rem;
                padding: 8px 10px;
            }
        }

        @media (max-width: 1024px) {
            .results-row .probability-visualization {
                flex: 0 0 45%;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs-and-options-row {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .chart-options-toolbar {
                justify-content: center;
                gap: 15px;
                flex-wrap: wrap;
            }

            .option-label {
                font-size: 0.8rem;
            }

            .mini-dropdown {
                font-size: 0.75rem;
                min-width: 45px;
            }

            .results-row {
                flex-direction: column;
                gap: 15px;
            }

            .results-row .probability-visualization {
                flex: none;
            }

            .results-row .embedded-results-panel {
                flex: none;
            }
        }

        /* Chart Options Toolbar Styles */
        .chart-options-toolbar {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .chart-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #bbb;
            font-weight: 500;
            white-space: nowrap;
        }

        .option-label i {
            font-size: 0.8rem;
            color: var(--primary-blue);
            opacity: 0.8;
        }

        .mini-dropdown {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            font-size: 0.8rem;
            min-width: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mini-dropdown:hover {
            background: rgba(255,255,255,0.12);
            border-color: var(--primary-blue);
        }

        .mini-dropdown:focus {
            outline: none;
            border-color: var(--primary-blue);
            background: rgba(52, 152, 219, 0.1);
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
        }

        .mini-dropdown option {
            background: #2c3e50;
            color: white;
            padding: 4px;
        }

        .formula-display {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            color: #e8e8e8;
            font-size: 0.95rem;
        }

        .chart-indicator {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .x-marker {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .x-marker::before {
            content: '';
            width: 3px;
            height: 20px;
            border-radius: 1px;
            opacity: 0.8;
        }

        .probability-result {
            background: linear-gradient(135deg, rgba(255,165,120,0.2) 0%, rgba(255,140,100,0.2) 100%);
            border: 2px solid rgba(255,165,120,0.6);
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            color: rgb(255,165,120);
            text-align: center;
            min-width: 120px;
        }

        /* Results Row Layout */
        .results-row {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            align-items: stretch;
        }

        .results-row .probability-visualization {
            flex: 0 0 45%;
            margin-top: 0;
        }

        .results-row .embedded-results-panel {
            flex: 1;
            margin-top: 0;
        }

        /* Embedded Results Panel Styles - Small Horizontal Boxes */
        .embedded-results-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .embedded-panel-title {
            font-size: 0.85rem;
            color: var(--header-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .embedded-stats-grid {
            display: flex;
            gap: 4px;
            flex-wrap: nowrap;
            justify-content: center;
            overflow-x: auto;
        }

        .embedded-stat-item {
            background: rgba(255,255,255,0.08);
            padding: 4px 6px;
            border-radius: 4px;
            text-align: center;
            min-width: 55px;
            flex: 0 0 auto;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }

        .embedded-stat-item.updating {
            transform: scale(1.05) translateY(-2px);
            background: rgba(52, 152, 219, 0.2);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3);
        }

        .embedded-stat-item:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .embedded-stat-item.primary-result {
            background: rgba(255,165,120,0.15);
            border: 1px solid rgba(255,165,120,0.3);
            min-width: 65px;
        }

        .embedded-stat-item.primary-result:hover {
            background: rgba(255,165,120,0.25);
            box-shadow: 0 4px 16px rgba(255,165,120,0.3);
        }

        .embedded-stat-value {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--header-color);
            line-height: 1.1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .embedded-stat-value.animating {
            color: rgb(255,165,120);
            transform: scale(1.1);
            text-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
        }

        .embedded-stat-item.primary-result .embedded-stat-value {
            color: rgb(255,165,120);
        }

        .embedded-stat-label {
            color: #bbb;
            font-size: 0.65rem;
            margin-top: 1px;
            line-height: 1;
            transition: color 0.3s ease;
        }

        /* Chart animation enhancements */
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-container > div {
            transition: opacity 0.3s ease;
        }

        .chart-container.animating {
            transform: scale(1.02);
            box-shadow: 0 8px 32px rgba(52, 152, 219, 0.3);
            border-radius: 12px;
        }

        /* Highcharts specific styling for dark theme */
        .highcharts-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
        }

        .highcharts-background {
            fill: transparent !important;
        }

        .highcharts-title {
            fill: white !important;
        }

        .highcharts-subtitle {
            fill: #bbb !important;
        }

        .highcharts-axis-labels text {
            fill: white !important;
        }

        .highcharts-axis-title {
            fill: white !important;
        }

        .highcharts-legend-item text {
            fill: white !important;
        }

        .highcharts-plot-line-label {
            color: white !important;
        }

        /* Animated chart indicators */
        .chart-indicator {
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .x-marker {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(20px);
            }
            50% {
                opacity: 1;
                transform: scale(1.05) translateY(-5px);
            }
            70% {
                transform: scale(0.95) translateY(2px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Tab switching animations */
        .tab-content {
            opacity: 0;
            transform: translateX(20px);
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .tab-content.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
            animation: tabSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes tabSlideIn {
            0% {
                opacity: 0;
                transform: translateX(30px) scale(0.95);
            }
            50% {
                opacity: 0.7;
                transform: translateX(10px) scale(0.98);
            }
            100% {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .tab {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab:hover {
            transform: translateY(-1px);
        }

        .tab.active {
            transform: translateY(0);
        }

        /* Reset animation effects */
        .resetting {
            animation: resetPulse 0.8s ease-in-out;
        }

        @keyframes resetPulse {
            0% {
                transform: scale(1);
                background: rgba(255,255,255,0.08);
            }
            25% {
                transform: scale(1.05);
                background: rgba(39, 174, 96, 0.2);
            }
            50% {
                transform: scale(1.02);
                background: rgba(39, 174, 96, 0.15);
            }
            75% {
                transform: scale(1.01);
                background: rgba(39, 174, 96, 0.1);
            }
            100% {
                transform: scale(1);
                background: rgba(255,255,255,0.08);
            }
        }

        .btn-success {
            position: relative;
            overflow: hidden;
        }

        .btn-success::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-success:hover::before {
            left: 100%;
        }

        /* Loading pulse effect for calculations */
        .calculating {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @media (max-width: 768px) {
            .embedded-stats-grid {
                gap: 3px;
                justify-content: flex-start;
            }

            .embedded-stat-item {
                min-width: 45px;
                padding: 3px 4px;
            }

            .embedded-stat-value {
                font-size: 0.6rem;
            }

            .embedded-stat-label {
                font-size: 0.45rem;
            }
        }

        /* Enhanced Tooltip System */
        .tooltip-container {
            position: relative;
            display: inline-block;
        }

        .tooltip {
            position: absolute;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            line-height: 1.4;
            max-width: 280px;
            width: max-content;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,165,120,0.3);
            pointer-events: none;
        }

        .tooltip::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid #2c3e50;
        }

        .tooltip.bottom {
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%) translateY(10px);
        }

        .tooltip.top {
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
        }

        .tooltip.top::before {
            top: auto;
            bottom: -6px;
            border-bottom: none;
            border-top: 6px solid #2c3e50;
        }

        .tooltip.left {
            right: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%) translateX(-10px);
        }

        .tooltip.left::before {
            left: auto;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            border-left: 6px solid #2c3e50;
            border-bottom: 6px solid transparent;
            border-top: 6px solid transparent;
        }

        .tooltip.right {
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%) translateX(10px);
        }

        .tooltip.right::before {
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            border-right: 6px solid #2c3e50;
            border-bottom: 6px solid transparent;
            border-top: 6px solid transparent;
        }

        .tooltip-container:hover .tooltip,
        .tooltip-container:focus-within .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .tooltip-container:hover .tooltip.top,
        .tooltip-container:focus-within .tooltip.top {
            transform: translateX(-50%) translateY(0);
        }

        .tooltip-container:hover .tooltip.left,
        .tooltip-container:focus-within .tooltip.left {
            transform: translateY(-50%) translateX(0);
        }

        .tooltip-container:hover .tooltip.right,
        .tooltip-container:focus-within .tooltip.right {
            transform: translateY(-50%) translateX(0);
        }

        .tooltip strong {
            color: var(--header-color);
            display: block;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .tooltip .tooltip-formula {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.3);
            padding: 4px 6px;
            border-radius: 4px;
            margin: 6px 0;
            font-size: 0.8rem;
            color: #e8e8e8;
        }

        .tooltip .tooltip-example {
            color: #bbb;
            font-style: italic;
            margin-top: 6px;
            font-size: 0.8rem;
        }

        /* Enhanced label styles for tooltips */
        .input-group label,
        .option-label,
        .embedded-stat-label {
            cursor: help;
            transition: color 0.3s ease;
        }

        .input-group label:hover,
        .option-label:hover {
            color: var(--header-color);
        }

        /* Tooltip indicator icon */
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: linear-gradient(135deg, rgb(255,165,120), rgb(230,140,90));
            color: white;
            border-radius: 50%;
            font-size: 8px;
            margin-left: 6px;
            vertical-align: middle;
            opacity: 0.7;
            transition: all 0.3s ease;
            cursor: help;
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
        }

        .tooltip-icon:hover {
            opacity: 1;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.4);
        }

        .tooltip-icon i {
            font-size: 7px;
        }

        /* Adjust tooltip containers for icon integration */
        .tooltip-container.with-icon {
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }

        /* About Distribution Modal */
        .about-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .about-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .about-content {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,165,120,0.3);
            position: relative;
            color: white;
            line-height: 1.6;
        }

        .about-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,165,120,0.3);
        }

        .about-title {
            font-size: 1.8rem;
            color: var(--header-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #bbb;
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 5px;
        }

        .close-modal:hover {
            color: var(--header-color);
        }

        .about-section {
            margin-bottom: 25px;
        }

        .about-section h3 {
            color: var(--header-color);
            font-size: 1.3rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .about-section p {
            margin-bottom: 12px;
            color: #e8e8e8;
        }

        .formula-box {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            border-left: 4px solid var(--header-color);
        }

        .formula-title {
            color: var(--header-color);
            font-weight: bold;
            margin-bottom: 8px;
            font-family: 'Segoe UI', sans-serif;
        }

        .historical-note {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid rgb(255,165,120);
        }

        .historical-note .note-title {
            color: rgb(255,165,120);
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .application-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .application-item h4 {
            color: var(--header-color);
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .application-item p {
            font-size: 0.9rem;
            color: #ccc;
        }

        .about-btn {
            background: linear-gradient(135deg, rgb(255,165,120), rgb(230,140,90));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        .about-btn:hover {
            background: linear-gradient(135deg, rgb(230,140,90), rgb(255,165,120));
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        /* Mobile tooltip adjustments */
        @media (max-width: 768px) {
            .tooltip {
                max-width: 220px;
                font-size: 0.8rem;
                padding: 10px 12px;
            }
            
            .tooltip.left,
            .tooltip.right {
                position: fixed;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
            }

            .about-content {
                margin: 20px;
                padding: 20px;
                max-width: calc(100% - 40px);
            }

            .about-title {
                font-size: 1.4rem;
            }

            .applications-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="content-wrapper">
            <div class="container">
                <div class="header">
                    <h1>
                        <i class="fas fa-chi"></i>
                        Chi-Square Distribution Calculator
                    </h1>
                    <div style="text-align: center; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px; border: 0px solid rgba(52, 152, 219, 0.3); margin-top: 15px;">
                        <i class="fas fa-bolt" style="color: rgb(255,165,120); margin-right: 8px;"></i>
                        <span style="color: rgb(255,165,120); font-weight: 600; font-size: 0.9rem;">Results update instantly as you type!</span>
                    </div>
                </div>
                <div class="main-content">
                    <div class="control-panel">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="panel-title" style="margin-bottom: 0;">
                                <i class="fas fa-edit">
                                </i>
                                Input Panel
                            </h3>
                            <button class="btn btn-success" onclick="reloadCalculator()" style="padding: 8px 12px; font-size: 0.85rem;">
                                <i class="fas fa-redo">
                                </i>
                                Reset
                            </button>
                        </div>
                        <div class="input-group">
                            <div class="tooltip-container with-icon">
                                <label>
                                    Degrees of Freedom (ν)
                                    <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Must be a positive integer</small>
                                </label>
                                <span class="tooltip-icon">
                                    <i class="fas fa-info"></i>
                                </span>
                                <div class="tooltip bottom">
                                    <strong>Degrees of Freedom (ν)</strong>
                                    The parameter that determines the shape of the chi-square distribution. It represents the number of independent variables in the system.
                                    <div class="tooltip-formula">ν ∈ {1, 2, 3, ...}</div>
                                    <div class="tooltip-example">Examples: ν=1 (very skewed), ν=5 (moderately skewed), ν=20 (approaching normal)</div>
                                </div>
                            </div>
                            <div class="input-row">
                                <input class="input-field" id="degreesOfFreedom" min="1" step="1" type="number" value="5" placeholder="e.g., 1, 5, 10"/>
                            </div>
                        </div>
                        <div class="calculation-type">
                            <h4 style="margin-bottom: 15px; color: var(--header-color);">
                                Calculation Type
                            </h4>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input checked="" name="calcType" type="radio" value="probability"/>
                                    <div>
                                        <strong>Find Probability P(X ≤ x)</strong>
                                        <small style="color: #bbb; display: block; margin-top: 2px;">What's the chance of getting a value ≤ x?</small>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input name="calcType" type="radio" value="between"/>
                                    <div>
                                        <strong>Find P(a ≤ X ≤ b)</strong>
                                        <small style="color: #bbb; display: block; margin-top: 2px;">What's the chance of getting a value between a and b?</small>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input name="calcType" type="radio" value="quantile"/>
                                    <div>
                                        <strong>Find Value for Given Probability</strong>
                                        <small style="color: #bbb; display: block; margin-top: 2px;">What value has this probability below it?</small>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div id="inputSection">
                            <div class="input-group">
                                <label>
                                    X Value
                                </label>
                                <input class="input-field" id="xValue" min="0" step="0.1" type="number" value="5"/>
                            </div>
                        </div>


                    </div>
                    <div class="visualization-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-chart-area">
                            </i>
                            Results Panel - Visualizations & Statistics
                        </h3>
                        <!-- Combined Tabs and Chart Options Row -->
                        <div class="tabs-and-options-row">
                            <!-- Tabs on the Left -->
                            <div class="tabs">
                                <div class="tab active tooltip-container" onclick="switchTab('pdf', this)">
                                    PDF View
                                    <div class="tooltip bottom">
                                        <strong>Probability Density Function</strong>
                                        Shows the shape of the distribution and where values are most likely to occur.
                                        <div class="tooltip-example">Peak shows mode, area under curve = probability</div>
                                    </div>
                                </div>
                                <div class="tab tooltip-container" onclick="switchTab('cdf', this)">
                                    CDF View
                                    <div class="tooltip bottom">
                                        <strong>Cumulative Distribution Function</strong>
                                        Shows the probability of getting a value ≤ x. Always increases from 0 to 1.
                                        <div class="tooltip-example">At x=5: CDF shows P(X ≤ 5)</div>
                                    </div>
                                </div>
                                <div class="tab tooltip-container" onclick="switchTab('both', this)">
                                    Combined View
                                    <div class="tooltip bottom">
                                        <strong>PDF + CDF Together</strong>
                                        Compare the shape (PDF) and cumulative probability (CDF) side by side.
                                        <div class="tooltip-example">See how PDF peaks relate to CDF slopes</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chart Options on the Right -->
                            <div class="chart-options-toolbar">
                                <div class="chart-option">
                                    <div class="tooltip-container with-icon">
                                        <label for="precision" class="option-label">
                                            <i class="fas fa-decimal"></i>
                                            Precision
                                        </label>
                                        <span class="tooltip-icon">
                                            <i class="fas fa-info"></i>
                                        </span>
                                        <div class="tooltip bottom">
                                            <strong>Decimal Precision</strong>
                                            Controls how many decimal places are shown in calculations and results.
                                            <div class="tooltip-example">Higher precision = more accurate results, especially for small probabilities</div>
                                        </div>
                                    </div>
                                    <select class="mini-dropdown" id="precision">
                                        <option selected value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                    </select>
                                </div>
                                <div class="chart-option">
                                    <div class="tooltip-container with-icon">
                                        <label for="chartRange" class="option-label">
                                            <i class="fas fa-expand-arrows-alt"></i>
                                            Range
                                        </label>
                                        <span class="tooltip-icon">
                                            <i class="fas fa-info"></i>
                                        </span>
                                        <div class="tooltip bottom">
                                            <strong>Chart Range Multiplier</strong>
                                            Adjusts how much of the distribution is visible on the chart by multiplying the standard display range.
                                            <div class="tooltip-example">1x = compact view, 3x = standard view, 5x = extended view</div>
                                        </div>
                                    </div>
                                    <select class="mini-dropdown" id="chartRange">
                                        <option value="1">1x</option>
                                        <option value="1.5">1.5x</option>
                                        <option value="2">2x</option>
                                        <option value="2.5">2.5x</option>
                                        <option selected value="3">3x</option>
                                        <option value="3.5">3.5x</option>
                                        <option value="4">4x</option>
                                        <option value="4.5">4.5x</option>
                                        <option value="5">5x</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="tab-content active" id="pdfTab">
                            <div class="chart-container">
                                <div id="pdfChart"></div>
                            </div>
                        </div>
                        <div class="tab-content" id="cdfTab">
                            <div class="chart-container">
                                <div id="cdfChart"></div>
                            </div>
                        </div>
                        <div class="tab-content" id="bothTab">
                            <div class="chart-container">
                                <div id="combinedChart"></div>
                            </div>
                        </div>
                        <!-- Combined Results Row - Shaded Area + Statistics -->
                        <div class="results-row">
                            <div class="probability-visualization">
                                <h4 style="color: var(--header-color); margin-bottom: 10px;">
                                    <i class="fas fa-area-chart">
                                    </i>
                                    Shaded Area Representation
                                </h4>
                                <div class="shaded-area-info">
                                    <span id="equationText" style="font-weight: bold; color: var(--header-color);">
                                        Select calculation type to see shaded area
                                    </span>
                                    <span id="percentageText" style="font-weight: bold; color: var(--header-color); display: none;">
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Embedded Results & Statistics Panel -->
                            <div class="embedded-results-panel">
                                <h4 class="embedded-panel-title">
                                    <i class="fas fa-chart-bar">
                                    </i>
                                    Distribution Statistics
                                </h4>
                                <div class="embedded-stats-grid">
                                    <div class="embedded-stat-item">
                                        <div class="embedded-stat-value" id="dfStat">
                                            5
                                        </div>
                                        <div class="embedded-stat-label">
                                            DoF (ν)
                                        </div>
                                    </div>
                                    <div class="embedded-stat-item">
                                        <div class="embedded-stat-value" id="meanStat">
                                            5
                                        </div>
                                        <div class="embedded-stat-label">
                                            Mean
                                        </div>
                                    </div>
                                    <div class="embedded-stat-item tooltip-container">
                                        <div class="embedded-stat-value" id="varianceStat">
                                            10
                                        </div>
                                        <div class="embedded-stat-label">
                                            Variance
                                        </div>
                                        <div class="tooltip top">
                                            <strong>Variance</strong>
                                            Measures how spread out the values are from the mean.
                                            <div class="tooltip-formula">Var(X) = 2ν</div>
                                            <div class="tooltip-example">Higher variance = more spread</div>
                                        </div>
                                    </div>
                                    <div class="embedded-stat-item tooltip-container">
                                        <div class="embedded-stat-value" id="stddevStat">
                                            3.16
                                        </div>
                                        <div class="embedded-stat-label">
                                            Std Dev
                                        </div>
                                        <div class="tooltip top">
                                            <strong>Standard Deviation</strong>
                                            Square root of variance, in the same units as the data.
                                            <div class="tooltip-formula">σ = √(2ν)</div>
                                            <div class="tooltip-example">68% of values within 1σ of mean</div>
                                        </div>
                                    </div>

                                    <div class="embedded-stat-item tooltip-container">
                                        <div class="embedded-stat-value" id="skewnessStat">
                                            1.26
                                        </div>
                                        <div class="embedded-stat-label">
                                            Skewness
                                        </div>
                                        <div class="tooltip top">
                                            <strong>Skewness</strong>
                                            Measures asymmetry. Positive = right tail longer.
                                            <div class="tooltip-formula">Skew = √(8/ν)</div>
                                            <div class="tooltip-example">Higher ν = less skewed (approaches normal)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- About Button at bottom of panel -->
                        <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <button class="about-btn" onclick="openAboutModal()">
                                <i class="fas fa-info-circle"></i>
                                About Chi-Square Distribution...
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let pdfChart, cdfChart, combinedChart;
        let currentCalcType = 'probability';
        let isInitialLoad = true;

        // Store chart data for animations
        let chartDataStore = {
            pdfData: [],
            cdfData: [],
            shadedPdfData: []
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Highcharts to load
            if (typeof Highcharts === 'undefined') {
                setTimeout(() => {
                    initializeApp();
                }, 100);
            } else {
                initializeApp();
            }
        });

        function initializeApp() {
            try {
                initializeCharts();
                updateInputSection();
                updateRadioSelection();
                updateStatistics();
                calculate();

                // Trigger initial animation only for PDF view (which is active by default)
                setTimeout(() => {
                    if (pdfChart && chartDataStore.pdfData.length > 0) {
                        triggerChartAnimations('pdf');
                    }
                }, 100); // Reduced delay to prevent flash

                // Add event listeners with visual feedback
                document.getElementById('degreesOfFreedom').addEventListener('input', debounce(calculateWithFeedback, 250));
                document.getElementById('chartRange').addEventListener('change', debounce(calculateWithFeedback, 250));
                document.getElementById('precision').addEventListener('change', debounce(calculateWithFeedback, 250));

                // Add event listener to initial X value input
                const initialXValue = document.getElementById('xValue');
                if (initialXValue) {
                    initialXValue.addEventListener('input', debounce(calculateWithFeedback, 250));
                }

                document.querySelectorAll('input[name="calcType"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        currentCalcType = this.value;
                        updateInputSection();
                        updateRadioSelection();
                        calculateWithFeedback();
                    });
                });

                // Add keyboard shortcuts
                document.addEventListener('keydown', function(e) {
                    // Ctrl+R or Cmd+R for reload (prevent default browser reload)
                    if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                        e.preventDefault();
                        reloadCalculator();
                    }
                    // F5 for reload
                    if (e.key === 'F5') {
                        e.preventDefault();
                        reloadCalculator();
                    }
                });

            } catch (error) {
                console.error('Initialization error:', error);
                // Fallback: show error message
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) mainResultEl.textContent = 'Loading...';
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateRadioSelection() {
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected', 'quantile-mode');
            });
            const selectedOption = document.querySelector(`input[value="${currentCalcType}"]`).closest('.radio-option');
            selectedOption.classList.add('selected');

            // Add blue styling for quantile mode
            if (currentCalcType === 'quantile') {
                selectedOption.classList.add('quantile-mode');
            }

            // Update shaded area info styling
            const shadedAreaInfo = document.querySelector('.shaded-area-info');
            if (shadedAreaInfo) {
                shadedAreaInfo.classList.remove('quantile-mode');
                if (currentCalcType === 'quantile') {
                    shadedAreaInfo.classList.add('quantile-mode');
                }
            }
        }

        function updateInputSection() {
            const inputSection = document.getElementById('inputSection');
            const calcType = document.querySelector('input[name="calcType"]:checked').value;

            let html = '';

            switch(calcType) {
                case 'probability':
                    html = `
                        <div class="input-group">
                            <label>X Value
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Find probability up to this value (must be ≥ 0)</small>
                            </label>
                            <input type="number" id="xValue" class="input-field" value="5" step="0.1" min="0" placeholder="e.g., 1.5, 5, 10">
                        </div>
                    `;
                    break;
                case 'between':
                    html = `
                        <div class="input-group">
                            <label style="margin-bottom: 8px; display: block;">Range Bounds
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Define the range [a, b] for the probability calculation (must be ≥ 0)</small>
                            </label>
                            <div class="input-row">
                                <div style="flex: 1;">
                                    <label style="font-size: 0.85rem; margin-bottom: 4px; display: block; color: #ddd;">Lower Bound (a)</label>
                                    <input type="number" id="lowerBound" class="input-field" value="2" step="0.1" min="0" placeholder="e.g., 0, 2, 5">
                                </div>
                                <div style="flex: 1;">
                                    <label style="font-size: 0.85rem; margin-bottom: 4px; display: block; color: #ddd;">Upper Bound (b)</label>
                                    <input type="number" id="upperBound" class="input-field" value="8" step="0.1" min="0" placeholder="e.g., 5, 10, 20">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'quantile':
                    html = `
                        <div class="input-group">
                            <label>Probability (0 to 1)
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Decimal between 0 and 1 (e.g., 0.5 = 50%)</small>
                            </label>
                            <input type="number" id="probability" class="input-field" value="0.5" step="0.01" min="0" max="1" placeholder="e.g., 0.5, 0.95, 0.05">
                        </div>
                    `;
                    break;
            }

            inputSection.innerHTML = html;

            // Add event listeners to new inputs
            inputSection.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', debounce(calculateWithFeedback, 250));
            });
        }

        function initializeCharts() {
            try {
                if (typeof Highcharts === 'undefined') {
                    console.error('Highcharts not loaded');
                    return;
                }

                // Set dark theme for all charts
                Highcharts.setOptions({
                    chart: {
                        backgroundColor: 'transparent',
                        style: {
                            fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif'
                        }
                    },
                    colors: ['#e67e22', '#27ae60', '#e74c3c', '#f39c12', '#9b59b6'],
                    title: {
                        style: {
                            color: 'white'
                        }
                    },
                    xAxis: {
                        gridLineColor: 'rgba(255,255,255,0.1)',
                        lineColor: 'rgba(255,255,255,0.3)',
                        tickColor: 'rgba(255,255,255,0.3)',
                        labels: {
                            style: {
                                color: 'white'
                            }
                        },
                        title: {
                            style: {
                                color: 'white'
                            }
                        }
                    },
                    yAxis: {
                        gridLineColor: 'rgba(255,255,255,0.1)',
                        lineColor: 'rgba(255,255,255,0.3)',
                        tickColor: 'rgba(255,255,255,0.3)',
                        labels: {
                            style: {
                                color: 'white'
                            }
                        },
                        title: {
                            style: {
                                color: 'white'
                            }
                        }
                    },
                    legend: {
                        itemStyle: {
                            color: 'white'
                        }
                    },
                    plotOptions: {
                        line: {
                            marker: {
                                enabled: false
                            }
                        },
                        area: {
                            marker: {
                                enabled: false
                            }
                        }
                    }
                });

                // PDF Chart
                pdfChart = Highcharts.chart('pdfChart', {
                    chart: {
                        type: 'line',
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        title: {
                            text: 'X'
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Density'
                        },
                        min: 0
                    },
                    series: [{
                        name: 'Probability Density',
                        data: [],
                        color: '#e67e22',
                        lineWidth: 3,
                        shadow: true
                    }, {
                        name: 'Shaded Area',
                        data: [],
                        type: 'area',
                        color: 'rgba(255, 165, 120, 0.4)',
                        lineWidth: 2,
                        fillOpacity: 0.3
                    }],
                    tooltip: {
                        shared: true,
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        style: {
                            color: 'white'
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    }
                });

                // CDF Chart
                cdfChart = Highcharts.chart('cdfChart', {
                    chart: {
                        type: 'line',

                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        title: {
                            text: 'X'
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'P(X ≤ x)'
                        },
                        min: 0,
                        max: 1
                    },
                    series: [{
                        name: 'Cumulative Probability',
                        data: [],
                        color: '#27ae60',
                        lineWidth: 3,
                        shadow: true
                    }],
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        style: {
                            color: 'white'
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    }
                });

                // Combined Chart
                combinedChart = Highcharts.chart('combinedChart', {
                    chart: {
                        type: 'line',
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        title: {
                            text: 'X'
                        }
                    },
                    yAxis: [{
                        title: {
                            text: 'PDF',
                            style: {
                                color: '#e67e22'
                            }
                        },
                        min: 0,
                        labels: {
                            style: {
                                color: '#e67e22'
                            }
                        }
                    }, {
                        title: {
                            text: 'CDF',
                            style: {
                                color: '#27ae60'
                            }
                        },
                        min: 0,
                        max: 1,
                        opposite: true,
                        labels: {
                            style: {
                                color: '#27ae60'
                            }
                        }
                    }],
                    series: [{
                        name: 'PDF',
                        data: [],
                        color: '#e67e22',
                        lineWidth: 3,
                        shadow: true,
                        yAxis: 0
                    }, {
                        name: 'CDF',
                        data: [],
                        color: '#27ae60',
                        lineWidth: 3,
                        shadow: true,
                        yAxis: 1
                    }],
                    tooltip: {
                        shared: true,
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        style: {
                            color: 'white'
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    }
                });

            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }

        // Chi-square distribution functions using jStat library
        // Much more reliable than custom implementations
        
        function chiSquarePDF(x, df) {
            if (typeof jStat === 'undefined') {
                console.error('jStat library not loaded');
                return NaN;
            }
            return jStat.chisquare.pdf(x, df);
        }

        function chiSquareCDF(x, df) {
            if (typeof jStat === 'undefined') {
                console.error('jStat library not loaded');
                return NaN;
            }
            return jStat.chisquare.cdf(x, df);
        }

        function chiSquareQuantile(p, df) {
            if (typeof jStat === 'undefined') {
                console.error('jStat library not loaded');
                return NaN;
            }
            return jStat.chisquare.inv(p, df);
        }

        function calculateWithFeedback() {
            // Add visual feedback to input fields (only visible ones)
            const inputFields = document.querySelectorAll('.input-field:not([style*="display: none"])');
            inputFields.forEach(field => {
                field.classList.add('updating');
                setTimeout(() => field.classList.remove('updating'), 600);
            });

            // Call main calculate function
            calculate();
        }

        function calculate() {
            try {
                const df = parseInt(document.getElementById('degreesOfFreedom').value) || 5;
                const precision = parseInt(document.getElementById('precision')?.value) || 2;
                const calcType = document.querySelector('input[name="calcType"]:checked').value;

                if (df <= 0) {
                    const mainResultEl = document.getElementById('mainResult');
                    if (mainResultEl) mainResultEl.textContent = 'Error: Degrees of freedom must be positive';
                    return;
                }

                let result, areaDescription;

                switch(calcType) {
                    case 'probability':
                        const xValue = parseFloat(document.getElementById('xValue')?.value) || 5;
                        if (xValue < 0) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = 'Error: X value must be non-negative';
                            return;
                        }
                        result = chiSquareCDF(xValue, df);
                        // Validate probability result
                        if (!isFinite(result) || result < 0 || result > 1) {
                            console.warn('Invalid probability result:', result, 'for x =', xValue, 'df =', df);
                            result = Math.min(1.0, Math.max(0.0, result || 0));
                        }
                        areaDescription = `P(X ≤ ${xValue})`;
                        updateFormulaDisplay('cdf');
                        break;

                    case 'between':
                        const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || 2;
                        const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 8;
                        if (lowerBound < 0 || upperBound < 0) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = 'Error: Bounds must be non-negative';
                            return;
                        }
                        if (lowerBound >= upperBound) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = 'Error: Lower bound must be less than upper bound';
                            return;
                        }
                        const lowerProb = chiSquareCDF(lowerBound, df);
                        const upperProb = chiSquareCDF(upperBound, df);
                        result = upperProb - lowerProb;
                        // Validate probability result
                        if (!isFinite(result) || result < 0 || result > 1) {
                            console.warn('Invalid probability result:', result, 'for bounds [', lowerBound, ',', upperBound, '] df =', df);
                            result = Math.min(1.0, Math.max(0.0, result || 0));
                        }
                        areaDescription = `P(${lowerBound} ≤ X ≤ ${upperBound})`;
                        updateFormulaDisplay('between');
                        break;

                    case 'quantile':
                        const probability = parseFloat(document.getElementById('probability')?.value) || 0.5;
                        if (probability < 0 || probability > 1) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = 'Error: Probability must be between 0 and 1';
                            return;
                        }
                        result = chiSquareQuantile(probability, df);
                        // Validate quantile result (should be non-negative and finite)
                        if (!isFinite(result) || result < 0) {
                            console.warn('Invalid quantile result:', result, 'for p =', probability, 'df =', df);
                            result = Math.max(0, result || 0);
                        }
                        areaDescription = `X such that P(X ≤ x = ${probability}) =`;
                        updateFormulaDisplay('quantile');
                        break;
                }

                // Add updating visual feedback to area info
                const areaInfoEl = document.querySelector('.shaded-area-info');
                if (areaInfoEl) {
                    areaInfoEl.classList.add('updating');
                    setTimeout(() => areaInfoEl.classList.remove('updating'), 1000);
                }

                // Update elements with animated transitions and staggered timing
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) {
                    animateNumber(mainResultEl, mainResultEl.textContent, result, 800);
                }

                // Update equation and percentage text with proper formatting
                const equationTextEl = document.getElementById('equationText');
                const percentageTextEl = document.getElementById('percentageText');
                if (equationTextEl && percentageTextEl) {
                    const precision = parseInt(document.getElementById('precision')?.value) || 2;
                    let equationText = '';
                    let percentageText = '';

                    switch(calcType) {
                        case 'probability':
                            const xValue = parseFloat(document.getElementById('xValue')?.value) || 5;
                            const percentage = (result * 100).toFixed(precision);
                            equationText = `P(X ≤ ${xValue}) = ${result.toFixed(precision)}`;
                            percentageText = `(${percentage}%)`;
                            break;
                        case 'between':
                            const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || 2;
                            const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 8;
                            const betweenPercentage = (result * 100).toFixed(precision);
                            equationText = `P(${lowerBound} ≤ X ≤ ${upperBound}) = ${result.toFixed(precision)}`;
                            percentageText = `(${betweenPercentage}%)`;
                            break;
                        case 'quantile':
                            const probability = parseFloat(document.getElementById('probability')?.value) || 0.5;
                            equationText = `X = ${result.toFixed(precision)}`;
                            percentageText = `P(X ≤ ${result.toFixed(precision)}) = ${probability.toFixed(precision)}`;
                            break;
                    }

                    // Fade out, change text, fade in
                    equationTextEl.style.opacity = '0.5';
                    percentageTextEl.style.opacity = '0.5';
                    equationTextEl.style.transition = 'opacity 0.3s ease';
                    percentageTextEl.style.transition = 'opacity 0.3s ease';

                    setTimeout(() => {
                        equationTextEl.textContent = equationText;
                        percentageTextEl.textContent = percentageText;
                        percentageTextEl.style.display = percentageText ? 'inline' : 'none';
                        equationTextEl.style.opacity = '1';
                        percentageTextEl.style.opacity = '1';
                    }, 150);
                }

                updateStatistics();
                // Skip immediate chart population on initial load to allow animation
                updateCharts(!isInitialLoad);

                // After first calculation, mark as no longer initial load
                if (isInitialLoad) {
                    isInitialLoad = false;
                }

            } catch (error) {
                console.error('Calculation error:', error);
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) mainResultEl.textContent = 'Calculation Error';
            }
        }

        // Enhanced animated number counter function with visual feedback
        function animateNumber(element, startValue, endValue, duration = 800, showVisualFeedback = true) {
            if (!element) return;

            const start = performance.now();
            const startNum = parseFloat(startValue) || 0;
            const endNum = parseFloat(endValue) || 0;
            const precision = parseInt(document.getElementById('precision')?.value) || 2;

            // Add visual feedback classes
            if (showVisualFeedback) {
                element.classList.add('animating');
                const parentItem = element.closest('.embedded-stat-item');
                if (parentItem) {
                    parentItem.classList.add('updating');
                }
            }

            function updateValue(currentTime) {
                const elapsed = currentTime - start;
                const progress = Math.min(elapsed / duration, 1);

                // Use smoother easing function (ease-out-quart)
                const easedProgress = 1 - Math.pow(1 - progress, 4);

                const currentValue = startNum + (endNum - startNum) * easedProgress;
                element.textContent = currentValue.toFixed(precision);

                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                } else {
                    element.textContent = endNum.toFixed(precision);

                    // Remove visual feedback classes
                    if (showVisualFeedback) {
                        setTimeout(() => {
                            element.classList.remove('animating');
                            const parentItem = element.closest('.embedded-stat-item');
                            if (parentItem) {
                                parentItem.classList.remove('updating');
                            }
                        }, 200);
                    }
                }
            }

            requestAnimationFrame(updateValue);
        }

        // Number animation with format control (for integer vs decimal formatting)
        function animateNumberWithFormat(element, startValue, endValue, duration = 800, isInteger = false) {
            if (!element) return;

            const start = performance.now();
            const startNum = parseFloat(startValue) || 0;
            const endNum = parseFloat(endValue) || 0;
            const precision = isInteger ? 0 : (parseInt(document.getElementById('precision')?.value) || 2);

            // Add visual feedback classes
            element.classList.add('animating');
            const parentItem = element.closest('.embedded-stat-item');
            if (parentItem) {
                parentItem.classList.add('updating');
            }

            function updateValue(currentTime) {
                const elapsed = currentTime - start;
                const progress = Math.min(elapsed / duration, 1);

                // Use smoother easing function (ease-out-quart)
                const easedProgress = 1 - Math.pow(1 - progress, 4);

                const currentValue = startNum + (endNum - startNum) * easedProgress;
                
                if (isInteger) {
                    element.textContent = Math.round(currentValue).toString();
                } else {
                    element.textContent = currentValue.toFixed(precision);
                }

                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                } else {
                    if (isInteger) {
                        element.textContent = Math.round(endNum).toString();
                    } else {
                        element.textContent = endNum.toFixed(precision);
                    }

                    // Remove visual feedback classes
                    setTimeout(() => {
                        element.classList.remove('animating');
                        const parentItem = element.closest('.embedded-stat-item');
                        if (parentItem) {
                            parentItem.classList.remove('updating');
                        }
                    }, 200);
                }
            }

            requestAnimationFrame(updateValue);
        }

        function updateStatistics() {
            const df = parseInt(document.getElementById('degreesOfFreedom')?.value) || 5;
            const precision = parseInt(document.getElementById('precision')?.value) || 2;

            // Chi-square distribution statistics
            const mean = df;
            const variance = 2 * df;
            const stddev = Math.sqrt(variance);
            const mode = Math.max(0, Math.round(df - 2));
            const skewness = Math.sqrt(8 / df);

            // Get current values for animation start points
            const statsElements = [
                { el: document.getElementById('dfStat'), value: df, delay: 0, isInteger: true },
                { el: document.getElementById('meanStat'), value: mean, delay: 100, isInteger: false },
                { el: document.getElementById('varianceStat'), value: variance, delay: 200, isInteger: false },
                { el: document.getElementById('stddevStat'), value: stddev, delay: 300, isInteger: false },
                { el: document.getElementById('modeStat'), value: mode, delay: 400, isInteger: true },
                { el: document.getElementById('skewnessStat'), value: skewness, delay: 500, isInteger: false }
            ];

            // Animate the value changes with staggered timing
            statsElements.forEach(({ el, value, delay, isInteger }) => {
                if (el) {
                    setTimeout(() => {
                        animateNumberWithFormat(el, el.textContent, value, 600, isInteger);
                    }, delay);
                }
            });
        }

        function updateCharts(skipAnimation = false) {
            const df = parseInt(document.getElementById('degreesOfFreedom').value) || 5;
            const range = parseFloat(document.getElementById('chartRange').value) || 3;
            const calcType = document.querySelector('input[name="calcType"]:checked').value;

            // Generate much more data points for ultra-smooth curves
            const points = 1000; // Increased to 1000 for ultra-smooth curves
            const maxX = df + range * Math.sqrt(2 * df); // Mean + range * stddev
            const minX = 0; // Chi-square is always non-negative
            const step = (maxX - minX) / points;

            const pdfData = [];
            const cdfData = [];
            const shadedPdfData = [];

            // Get X values for marking
            let xMarkers = [];
            switch(calcType) {
                case 'probability':
                    const xValue = parseFloat(document.getElementById('xValue')?.value) || 5;
                    xMarkers = [{ value: xValue, label: `X = ${xValue}`, color: '#ff6b6b' }];
                    break;
                case 'between':
                    const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || 2;
                    const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 8;
                    xMarkers = [
                        { value: lowerBound, label: `a = ${lowerBound}`, color: '#4ecdc4' },
                        { value: upperBound, label: `b = ${upperBound}`, color: '#45b7d1' }
                    ];
                    break;
                case 'quantile':
                    const probability = parseFloat(document.getElementById('probability')?.value) || 0.5;
                    const quantileValue = chiSquareQuantile(probability, df);
                    xMarkers = [{ value: quantileValue, label: `X = ${quantileValue.toFixed(3)}`, color: '#96ceb4' }];
                    break;
            }

            // Generate ultra-smooth curve data
            for (let i = 0; i <= points; i++) {
                const x = minX + i * step;
                const pdfValue = chiSquarePDF(x, df);
                const cdfValue = chiSquareCDF(x, df);

                pdfData.push([x, pdfValue]);
                cdfData.push([x, cdfValue]);

                // Determine if this point should be in the shaded area
                let inShadedArea = false;

                switch(calcType) {
                    case 'probability':
                        const xValue = parseFloat(document.getElementById('xValue')?.value) || 5;
                        inShadedArea = x <= xValue;
                        break;
                    case 'between':
                        const lowerBound = parseFloat(document.getElementById('lowerBound')?.value) || 2;
                        const upperBound = parseFloat(document.getElementById('upperBound')?.value) || 8;
                        inShadedArea = x >= lowerBound && x <= upperBound;
                        break;
                    case 'quantile':
                        // No shading for quantile calculations
                        inShadedArea = false;
                        break;
                }

                if (inShadedArea) {
                    shadedPdfData.push([x, pdfValue]);
                }
            }

            // Store data globally for animations
            chartDataStore.pdfData = [...pdfData];
            chartDataStore.cdfData = [...cdfData];
            chartDataStore.shadedPdfData = [...shadedPdfData];

            // Update PDF chart (skip if animation is planned)
            if (pdfChart && pdfChart.series && pdfChart.series[0] && !skipAnimation) {
                try {
                    pdfChart.series[0].setData(pdfData, false);
                    if (pdfChart.series[1]) {
                        pdfChart.series[1].setData(shadedPdfData, false);
                    }

                    // Update X axis range
                    if (pdfChart.xAxis && pdfChart.xAxis[0]) {
                        pdfChart.xAxis[0].setExtremes(minX, maxX, false);
                    }
                } catch (error) {
                    console.warn('Error updating PDF chart data:', error);
                }

                // Add plot lines for markers
                // Remove existing plot lines first (with error checking)
                try {
                    if (pdfChart && pdfChart.xAxis && pdfChart.xAxis[0]) {
                        for (let i = 0; i < 5; i++) {
                            pdfChart.xAxis[0].removePlotLine(`marker-${i}`);
                        }
                        xMarkers.forEach((marker, index) => {
                            pdfChart.xAxis[0].addPlotLine({
                                id: `marker-${index}`,
                                value: marker.value,
                                color: marker.color,
                                width: 3,
                                dashStyle: 'Dash',
                                label: {
                                    text: marker.label,
                                    style: {
                                        color: 'white',
                                        fontWeight: 'bold'
                                    },
                                    align: 'center'
                                }
                            });
                        });
                    }
                } catch (error) {
                    console.warn('Error updating PDF chart plot lines:', error);
                }

                try {
                    pdfChart.redraw();
                } catch (error) {
                    console.warn('Error redrawing PDF chart:', error);
                }
            }

            // Update CDF chart (skip if animation is planned)
            if (cdfChart && cdfChart.series && cdfChart.series[0] && !skipAnimation) {
                try {
                    cdfChart.series[0].setData(cdfData, false);

                    // Update X axis range
                    if (cdfChart.xAxis && cdfChart.xAxis[0]) {
                        cdfChart.xAxis[0].setExtremes(minX, maxX, false);
                    }
                } catch (error) {
                    console.warn('Error updating CDF chart data:', error);
                }

                // Add plot lines for markers
                // Remove existing plot lines first (with error checking)
                try {
                    if (cdfChart && cdfChart.xAxis && cdfChart.xAxis[0]) {
                        for (let i = 0; i < 5; i++) {
                            cdfChart.xAxis[0].removePlotLine(`marker-${i}`);
                        }
                        xMarkers.forEach((marker, index) => {
                            cdfChart.xAxis[0].addPlotLine({
                                id: `marker-${index}`,
                                value: marker.value,
                                color: marker.color,
                                width: 3,
                                dashStyle: 'Dash',
                                label: {
                                    text: marker.label,
                                    style: {
                                        color: 'white',
                                        fontWeight: 'bold'
                                    },
                                    align: 'center'
                                }
                            });
                        });
                    }
                } catch (error) {
                    console.warn('Error updating CDF chart plot lines:', error);
                }

                try {
                    cdfChart.redraw();
                } catch (error) {
                    console.warn('Error redrawing CDF chart:', error);
                }
            }

            // Update combined chart (skip if animation is planned)
            if (combinedChart && combinedChart.series && combinedChart.series[0] && !skipAnimation) {
                try {
                    combinedChart.series[0].setData(pdfData, false);
                    if (combinedChart.series[1]) {
                        combinedChart.series[1].setData(cdfData, false);
                    }

                    // Update X axis range
                    if (combinedChart.xAxis && combinedChart.xAxis[0]) {
                        combinedChart.xAxis[0].setExtremes(minX, maxX, false);
                    }
                } catch (error) {
                    console.warn('Error updating Combined chart data:', error);
                }

                // Add plot lines for markers
                // Remove existing plot lines first (with error checking)
                try {
                    if (combinedChart && combinedChart.xAxis && combinedChart.xAxis[0]) {
                        for (let i = 0; i < 5; i++) {
                            combinedChart.xAxis[0].removePlotLine(`marker-${i}`);
                        }
                        xMarkers.forEach((marker, index) => {
                            combinedChart.xAxis[0].addPlotLine({
                                id: `marker-${index}`,
                                value: marker.value,
                                color: marker.color,
                                width: 3,
                                dashStyle: 'Dash',
                                label: {
                                    text: marker.label,
                                    style: {
                                        color: 'white',
                                        fontWeight: 'bold'
                                    },
                                    align: 'center'
                                }
                            });
                        });
                    }
                } catch (error) {
                    console.warn('Error updating Combined chart plot lines:', error);
                }

                try {
                    combinedChart.redraw();
                } catch (error) {
                    console.warn('Error redrawing Combined chart:', error);
                }
            }

            // Add visual indicators to chart container
            updateChartIndicators(xMarkers, calcType);
        }

        function updateChartIndicators(xMarkers, calcType) {
            // Remove existing indicators
            document.querySelectorAll('.chart-indicator').forEach(el => el.remove());
            
            // Chart indicators are no longer needed since information is shown in shaded area and plot lines
            // This function is kept for compatibility but does not create new indicators
        }

        function updateFormulaDisplay(type) {
            const formulaDisplay = document.getElementById('formulaDisplay');
            if (!formulaDisplay) return; // Safety check

            let formula = '';

            switch(type) {
                case 'cdf':
                    formula = `
                        <strong>Chi-Square Cumulative Distribution Function (CDF):</strong><br>
                        P(X ≤ x) = γ(ν/2, x/2) / Γ(ν/2)<br><br>
                        <strong>Where:</strong><br>
                        • γ is the lower incomplete gamma function<br>
                        • Γ is the gamma function<br>
                        • ν = degrees of freedom
                    `;
                    break;
                case 'between':
                    formula = `
                        <strong>Probability Between Two Values:</strong><br>
                        P(a ≤ X ≤ b) = P(X ≤ b) - P(X ≤ a)<br><br>
                        <strong>Where:</strong><br>
                        • P(X ≤ x) is the chi-square CDF<br>
                        • ν = degrees of freedom
                    `;
                    break;
                case 'quantile':
                    formula = `
                        <strong>Chi-Square Quantile Function (Inverse CDF):</strong><br>
                        x = F⁻¹(p, ν)<br><br>
                        <strong>Where:</strong><br>
                        • F⁻¹ is the inverse chi-square CDF<br>
                        • p = probability, ν = degrees of freedom
                    `;
                    break;
                default:
                    formula = 'Select a calculation type to see the relevant formula';
            }

            formulaDisplay.innerHTML = formula;
        }

        function switchTab(tabName, clickedElement) {
            // Get the clicked element - either from parameter or event
            const tabElement = clickedElement || event?.target || document.querySelector(`.tab[onclick*="${tabName}"]`);

            if (!tabElement) {
                console.error('Tab element not found for:', tabName);
                return;
            }

            // Add switching animation to the clicked tab
            tabElement.classList.add('switching');
            setTimeout(() => {
                tabElement.classList.remove('switching');
            }, 800);

            // Hide all tab contents with fade out
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content with delay for smooth transition
            setTimeout(() => {
                document.getElementById(tabName + 'Tab').classList.add('active');

                // Add active class to selected tab
                tabElement.classList.add('active');

                // Trigger chart animations when switching tabs
                setTimeout(() => {
                    triggerChartAnimations(tabName);
                }, 300); // Delay to ensure tab content is visible
            }, 100);
        }

        function triggerChartAnimations(tabName) {
            // Force chart animations by temporarily hiding and showing series
            switch(tabName) {
                case 'pdf':
                    if (pdfChart) {
                        animateChartSeries(pdfChart, 'pdf');
                        // Animate chart indicators
                        animateChartIndicators();
                    }
                    break;
                case 'cdf':
                    if (cdfChart) {
                        animateChartSeries(cdfChart, 'cdf');
                        animateChartIndicators();
                    }
                    break;
                case 'both':
                    if (combinedChart) {
                        animateChartSeries(combinedChart, 'combined');
                        animateChartIndicators();
                    }
                    break;
            }
        }

        function animateChartIndicators() {
            // Add glow effect to chart indicators
            const indicators = document.querySelectorAll('.chart-indicator');
            indicators.forEach((indicator, index) => {
                setTimeout(() => {
                    indicator.style.transform = 'scale(1.05)';
                    indicator.style.boxShadow = '0 8px 32px rgba(52, 152, 219, 0.4)';
                    indicator.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';

                    setTimeout(() => {
                        indicator.style.transform = 'scale(1)';
                        indicator.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                    }, 600);
                }, index * 100);
            });
        }

        function animateChartSeries(chart, chartType) {
            try {
                if (!chart || !chart.series || !chart.container) {
                    console.warn('Chart not properly initialized for animation');
                    return;
                }

                // Get the stored data based on chart type
                let originalData = [];
                switch(chartType) {
                    case 'pdf':
                        originalData = [
                            [...chartDataStore.pdfData],
                            [...chartDataStore.shadedPdfData]
                        ];
                        break;
                    case 'cdf':
                        originalData = [
                            [...chartDataStore.cdfData]
                        ];
                        break;
                    case 'combined':
                        originalData = [
                            [...chartDataStore.pdfData],
                            [...chartDataStore.cdfData]
                        ];
                        break;
                    default:
                        console.warn('Unknown chart type for animation:', chartType);
                        return;
                }

                // Add animating class to chart container
                const chartContainer = chart.container.parentElement;
                if (chartContainer) {
                    chartContainer.classList.add('animating', 'drawing-curves');
                }

                // Animate each series with true progressive drawing
                chart.series.forEach((series, seriesIndex) => {
                    if (series && typeof series.setData === 'function' && originalData[seriesIndex] && originalData[seriesIndex].length > 0) {
                        const fullData = originalData[seriesIndex];

                        // Start the progressive drawing animation
                        let pointIndex = 0;
                        const totalPoints = fullData.length;
                        const animationDuration = 1200; // 1.2 seconds
                        const pointsPerFrame = Math.max(1, Math.floor(totalPoints / 60)); // ~60 frames for smooth animation

                        const drawNextPoints = () => {
                            if (pointIndex >= totalPoints) {
                                // Animation complete - ensure all data is set
                                try {
                                    series.setData(fullData, false);
                                    chart.redraw(false);
                                } catch (finalError) {
                                    console.warn('Error in final step:', finalError);
                                }
                                return;
                            }

                            // Calculate next chunk of points to add
                            const nextIndex = Math.min(pointIndex + pointsPerFrame, totalPoints);
                            const currentData = fullData.slice(0, nextIndex);

                            try {
                                // Update series without internal animation to avoid conflicts
                                series.setData(currentData, false);
                                chart.redraw(false);

                                pointIndex = nextIndex;

                                // Schedule next frame
                                requestAnimationFrame(drawNextPoints);

                            } catch (animError) {
                                console.warn('Error during progressive drawing:', animError);
                                // Try to continue with next frame
                                pointIndex = nextIndex;
                                requestAnimationFrame(drawNextPoints);
                            }
                        };

                        // Start animation with staggered delay for multiple series
                        setTimeout(() => {
                            // Ensure series is empty before starting
                            try {
                                series.setData([], false);
                                chart.redraw(false);
                                // Start progressive drawing
                                requestAnimationFrame(drawNextPoints);
                            } catch (startError) {
                                console.warn('Error starting animation:', startError);
                            }
                        }, seriesIndex * 300);
                    }
                });

                // Remove animating classes after animation completes
                setTimeout(() => {
                    if (chartContainer) {
                        chartContainer.classList.remove('animating', 'drawing-curves');
                    }
                }, 2000);

            } catch (error) {
                console.warn('Error in animateChartSeries:', error);
            }
        }



        function reloadCalculator() {
            // Add visual feedback to all statistics boxes
            document.querySelectorAll('.embedded-stat-item').forEach(item => {
                item.classList.add('resetting');
                setTimeout(() => item.classList.remove('resetting'), 800);
            });

            // Show loading state
            const mainResultEl = document.getElementById('mainResult');
            if (mainResultEl) {
                mainResultEl.classList.add('calculating');
                mainResultEl.textContent = 'Resetting...';
            }

            // Reset all input values to defaults with animation
            const inputs = [
                { el: document.getElementById('degreesOfFreedom'), value: '5' },
                { el: document.getElementById('xValue'), value: '5' },
                { el: document.getElementById('precision'), value: '4' },
                { el: document.getElementById('chartRange'), value: '3' }
            ];

            inputs.forEach(({ el, value }, index) => {
                if (el) {
                    setTimeout(() => {
                        el.style.transition = 'all 0.3s ease';
                        el.style.transform = 'scale(1.05)';
                        el.value = value;

                        setTimeout(() => {
                            el.style.transform = 'scale(1)';
                        }, 150);
                    }, index * 100);
                }
            });

            // Reset radio button to default (probability)
            const probabilityRadio = document.querySelector('input[value="probability"]');
            if (probabilityRadio) {
                probabilityRadio.checked = true;
                currentCalcType = 'probability';
            }

            // Reset chart options dropdowns
            const precisionDropdown = document.getElementById('precision');
            const chartRangeDropdown = document.getElementById('chartRange');
            if (precisionDropdown) precisionDropdown.value = '4';
            if (chartRangeDropdown) chartRangeDropdown.value = '3';

            // Reset tab to PDF view with animation
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            setTimeout(() => {
                const pdfTab = document.querySelector('.tab');
                const pdfTabContent = document.getElementById('pdfTab');
                if (pdfTab) pdfTab.classList.add('active');
                if (pdfTabContent) pdfTabContent.classList.add('active');
            }, 200);

            // Clear any dynamic input sections and recreate default
            updateInputSection();
            updateRadioSelection();

            // Animate reset with delay for better UX
            setTimeout(() => {
                if (mainResultEl) {
                    mainResultEl.classList.remove('calculating');
                }

                // Recalculate with default values
                updateStatistics();
                calculate();

                // Show success message briefly
                if (mainResultEl) {
                    const originalText = mainResultEl.textContent;
                    mainResultEl.textContent = '✓ Reset Complete!';
                    mainResultEl.style.color = '#27ae60';
                    mainResultEl.style.fontWeight = 'bold';

                    setTimeout(() => {
                        mainResultEl.style.color = '';
                        mainResultEl.style.fontWeight = '';
                        mainResultEl.textContent = originalText;
                    }, 1500);
                }

                // Add celebration effect
                createCelebrationEffect();

            }, 1000);
        }

        function createCelebrationEffect() {
            // Create a subtle celebration effect
            const header = document.querySelector('.header');
            if (header) {
                header.style.transform = 'scale(1.02)';
                header.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    header.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // About Modal Functions
        function openAboutModal() {
            const modal = document.getElementById('aboutModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }

        function closeAboutModal() {
            const modal = document.getElementById('aboutModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto'; // Restore background scrolling
            }
        }

        // Close modal when clicking outside the content
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('aboutModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeAboutModal();
                    }
                });

                // Close modal with Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.classList.contains('active')) {
                        closeAboutModal();
                    }
                });
            }
        });
    </script>

    <!-- About Chi-Square Distribution Modal -->
    <div id="aboutModal" class="about-modal">
        <div class="about-content">
            <div class="about-header">
                <div class="about-title">
                    <i class="fas fa-chi"></i>
                    About the Chi-Square Distribution
                </div>
                <button class="close-modal" onclick="closeAboutModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-info-circle"></i> What is the Chi-Square Distribution?</h3>
                <p>The chi-square (χ²) distribution is one of the most important probability distributions in statistics, particularly for hypothesis testing and confidence interval estimation. It emerges naturally when dealing with sums of squared normal random variables.</p>
                <p>The distribution is characterized by its degrees of freedom parameter (ν), which determines its shape. Unlike the normal distribution, chi-square is always non-negative and typically right-skewed, especially for small degrees of freedom.</p>
                
                <div class="formula-box">
                    <div class="formula-title">Probability Density Function (PDF)</div>
                    f(x) = (1/(2^(ν/2) × Γ(ν/2))) × x^((ν/2)-1) × e^(-x/2)
                    <br><br>
                    <strong>Where:</strong><br>
                    • ν = degrees of freedom (positive integer)<br>
                    • Γ = gamma function<br>
                    • x ≥ 0 (chi-square values are always non-negative)<br>
                    • e ≈ 2.71828...
                </div>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-history"></i> Historical Background</h3>
                <div class="historical-note">
                    <div class="note-title">
                        <i class="fas fa-landmark"></i>
                        Early Development (1875)
                    </div>
                    <p><strong>Friedrich Robert Helmert</strong> first derived what we now call the chi-square distribution while working on error analysis in astronomy and geodesy. He discovered that the sum of squared normal errors follows this special distribution.</p>
                </div>
                
                <div class="historical-note">
                    <div class="note-title">
                        <i class="fas fa-user-graduate"></i>
                        Karl Pearson (1857-1936)
                    </div>
                    <p><strong>Karl Pearson</strong> developed the famous Pearson's chi-square test in 1900, giving the distribution its name and establishing its fundamental role in goodness-of-fit testing. His work revolutionized statistical hypothesis testing.</p>
                </div>

                <div class="historical-note">
                    <div class="note-title">
                        <i class="fas fa-flask"></i>
                        Ronald Fisher (1890-1962)
                    </div>
                    <p><strong>R.A. Fisher</strong> extensively developed the theoretical foundation of the chi-square distribution and connected it to the analysis of variance (ANOVA), making it central to modern statistical inference.</p>
                </div>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-cogs"></i> Key Properties</h3>
                <p><strong>Non-negative:</strong> Chi-square values are always ≥ 0, making it ideal for modeling squared quantities.</p>
                <p><strong>Right-skewed:</strong> The distribution has a long right tail, especially for small degrees of freedom.</p>
                <p><strong>Additive:</strong> If X₁ ~ χ²(ν₁) and X₂ ~ χ²(ν₂) are independent, then X₁ + X₂ ~ χ²(ν₁ + ν₂).</p>
                <p><strong>Convergence to Normal:</strong> As ν increases, the distribution approaches normality.</p>
                <p><strong>Relationship to Normal:</strong> If Z ~ N(0,1), then Z² ~ χ²(1).</p>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-calculator"></i> Mathematical Properties</h3>
                <div class="formula-box">
                    <div class="formula-title">Key Statistics</div>
                    • <strong>Mean:</strong> E[X] = ν<br>
                    • <strong>Variance:</strong> Var(X) = 2ν<br>
                    • <strong>Standard Deviation:</strong> SD(X) = √(2ν)<br>
                    • <strong>Skewness:</strong> √(8/ν)<br>
                    • <strong>Mode:</strong> max(0, ν-2)<br>
                    • <strong>Support:</strong> x ∈ [0, ∞)<br>
                    • <strong>Moment Generating Function:</strong> (1-2t)^(-ν/2)
                </div>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-globe"></i> Real-World Applications</h3>
                <div class="applications-grid">
                    <div class="application-item">
                        <h4><i class="fas fa-chart-pie"></i> Goodness-of-Fit Tests</h4>
                        <p>Testing whether observed data follows a hypothesized distribution, commonly used in quality control and survey analysis.</p>
                    </div>
                    <div class="application-item">
                        <h4><i class="fas fa-table"></i> Independence Testing</h4>
                        <p>Chi-square test of independence determines whether two categorical variables are related in contingency table analysis.</p>
                    </div>
                    <div class="application-item">
                        <h4><i class="fas fa-balance-scale"></i> Variance Testing</h4>
                        <p>Confidence intervals and hypothesis tests for population variance in quality control and process monitoring.</p>
                    </div>
                    <div class="application-item">
                        <h4><i class="fas fa-dna"></i> Genetics</h4>
                        <p>Testing Hardy-Weinberg equilibrium and analyzing genetic linkage in population genetics studies.</p>
                    </div>
                    <div class="application-item">
                        <h4><i class="fas fa-poll-h"></i> Survey Research</h4>
                        <p>Analyzing categorical survey responses and testing relationships between demographic variables.</p>
                    </div>
                    <div class="application-item">
                        <h4><i class="fas fa-microscope"></i> Scientific Research</h4>
                        <p>Comparing observed vs. expected frequencies in experimental data across many scientific disciplines.</p>
                    </div>
                </div>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-lightbulb"></i> Connection to Other Distributions</h3>
                <p><strong>Normal Distribution:</strong> If Z₁, Z₂, ..., Zₙ are independent standard normal variables, then ∑Zᵢ² ~ χ²(n).</p>
                <p><strong>Gamma Distribution:</strong> χ²(ν) is equivalent to Gamma(ν/2, 2), connecting it to exponential and Poisson processes.</p>
                <p><strong>Student's t-Distribution:</strong> The t-distribution uses chi-square in its denominator, linking hypothesis testing procedures.</p>
                <p><strong>F-Distribution:</strong> The ratio of two independent chi-square variables (divided by their degrees of freedom) follows an F-distribution.</p>
            </div>

            <div class="about-section">
                <h3><i class="fas fa-tools"></i> Using This Calculator</h3>
                <p>This calculator helps you explore the chi-square distribution by:</p>
                <ul style="margin-left: 20px; color: #ccc;">
                    <li><strong>Adjusting Degrees of Freedom:</strong> See how ν affects the shape from highly skewed (ν=1) to nearly normal (ν>30)</li>
                    <li><strong>Computing Probabilities:</strong> Find P(X ≤ x), P(a ≤ X ≤ b), or critical values for given probabilities</li>
                    <li><strong>Visualizing Results:</strong> Compare PDF and CDF views with shaded areas showing probabilities</li>
                    <li><strong>Statistical Testing:</strong> Use critical values for hypothesis tests and confidence intervals</li>
                </ul>
            </div>
        </div>
    </div>
            </div>
        </div>
    </div>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: sans-serif;
        }
        #main-wrapper {
            width: 75vw;
            max-width: 1000px;
            margin: 0 auto;
            height: 95vh;
            overflow-y: auto;
            box-sizing: border-box;
            padding: 1rem;
        }
    </style>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        .main-container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>
        Binomial Distribution Calculator
    </title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/annotations.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
    <style>
        :root {
            --surface-0: #0c1624; /* page background */
            --surface-1: #1a1f2e; /* cards / panels - warmer dark gray-blue */
            --surface-2: #242938; /* chart / results boxes */
            --border: #2d3748; /* softer border color */
            --accent-1: rgb(255,165,120); /* warm orange */
            --accent-2: rgb(120,200,255); /* cyan blue */
            --text-primary: #ffffff;
            --text-secondary: rgba(255,255,255,0.8);
            --text-muted: rgba(255,255,255,0.6);
            --panel-bg: var(--surface-1);
            --panel-radius: 10px;
            --panel-shadow: 0px 4px 20px rgba(0, 0, 0, 0.4);
            --header-bg: var(--surface-0);
            --header-color: var(--accent-1);
            --highlight-bg: rgba(255, 165, 120, 0.2);
            --highlight-text: var(--accent-1);
            --primary-blue: var(--accent-1);
            --primary-blue-hover: rgb(230,140,90);
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
            --pad: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--surface-0);
            color: var(--text-primary);
        }

        #main-wrapper {
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-wrapper {
            flex: 1;
            padding: 15px;
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
            overflow: hidden;
        }

        .header {
            text-align: center;
            padding: 12px;
            background: linear-gradient(135deg, var(--header-bg) 0%, #1a1a2e 100%);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--header-color);
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            color: #bbb;
            font-size: 0.95rem;
            font-weight: 300;
        }

        .main-content {
    display: grid;
    grid-template-columns: 1fr 2fr;
    grid-template-rows: auto 1fr;
    grid-template-areas:
        "controlPanel resultHero"
        "controlPanel vizPanel";
    gap: 15px;
    flex: 1;
    min-height: 0;
    overflow: hidden;
}

        .control-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 18px;
            height: 100%;
            border: 0px solid var(--header-color);;
            grid-area: controlPanel;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
}

        .control-panel::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .visualization-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 18px;
            display: flex;
            flex-direction: column;
            height: 100%;
            border: 0px solid var(--header-color);;
            grid-area: vizPanel;
            overflow: hidden;
}


/* ------------------------------
   RESULT-FIRST HERO
-------------------------------- */
.result-hero {
  grid-area: resultHero;

  background:
    linear-gradient(135deg, rgba(255,165,120,0.08), rgba(120,200,255,0.06)),
    rgba(12,18,28,0.72);

  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--panel-radius);

  box-shadow:
    0 10px 28px rgba(0,0,0,0.35),
    inset 0 0 0 1px rgba(255,255,255,0.06);

  padding: 12px 15px;

  display: flex;
  flex-wrap: wrap;
  gap: 12px;

  align-items: stretch;
  justify-content: space-between;

  position: relative;
  max-height: 100%;
  overflow: hidden;
}


.result-hero-left {
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-width: 240px;
    flex: 1;
}

.result-hero-label {
    color: var(--text-secondary);
    font-weight: 700;
    letter-spacing: 0.2px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.result-hero-label small {
    color: var(--text-muted);
    font-weight: 500;
}

.result-hero-value {
    font-size: 1.8rem;
    font-weight: 800;
    line-height: 1.05;
    color: rgb(120,165,255);
    text-shadow:
        0 0 20px rgba(120,165,255,0.8),
        0 0 40px rgba(120,165,255,0.6),
        0 0 60px rgba(120,165,255,0.4),
        0 0 80px rgba(120,165,255,0.2),
        0 6px 22px rgba(120,165,255,0.25);
}

.result-hero-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 2px;
}

.btn-ghost {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.14);
    color: var(--text-primary);
    box-shadow: none;
}
.btn-ghost:hover {
    background: rgba(255,255,255,0.10);
    transform: translateY(-1px);
}

.result-hero-right {
    display: flex;
    gap: 10px;
    align-items: stretch;
    flex: 1;
    justify-content: flex-end;
}

.result-hero-card {
    background: rgba(0,0,0,0.22);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 10px;
    padding: 10px;
    min-width: 220px;
    max-width: 420px;
}

.result-hero-card h4 {
    font-size: 0.85rem;
    color: var(--header-color);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Calmer shaded-area styling in hero */
.result-hero .shaded-area-info {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.08);
}

/* Stats panel inside hero */
.result-hero .embedded-results-panel {
    background: transparent;
    border: none;
    padding: 0;
    margin: 0;
}

.result-hero .embedded-stats-grid {
    justify-content: flex-start;
}

@media (max-width: 1024px) {
    .main-content {
        grid-template-columns: 1fr;
        grid-template-areas:
            "resultHero"
            "controlPanel"
            "vizPanel";
    }
    .result-hero {
        flex-direction: column;
        align-items: stretch;
    }
    .result-hero-right {
        justify-content: stretch;
        flex-direction: column;
    }
    .result-hero-card {
        min-width: 0;
        max-width: none;
    }
}
.panel-title {
            font-size: 1.1rem;
            color: var(--header-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .input-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            max-width: 150px;
            padding: 8px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--surface-2);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-1);
            background: var(--surface-1);
            box-shadow: 0 0 10px rgba(255, 165, 120, 0.3);
        }

        .input-field.updating {
            border-color: var(--accent-1);
            background: rgba(255, 165, 120, 0.1);
            box-shadow: 0 0 12px rgba(255, 165, 120, 0.4);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-1) 0%, var(--accent-2) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 165, 120, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-blue-hover) 0%, var(--accent-1) 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 120, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #229954);
            color: white;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954, var(--success-green));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .calculation-type {
            margin-bottom: 12px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-option {
            display: flex;
            align-items: flex-start;
            padding: 10px;
            border: 2px solid #555;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            min-height: fit-content;
            overflow: visible;
        }
        
        .radio-option div {
            flex: 1;
            overflow: visible;
        }

        .radio-option:hover {
            border-color: var(--primary-blue);
            background: rgba(52, 152, 219, 0.1);
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--primary-blue);
            flex-shrink: 0;
            margin-top: 4px;
        }

        .radio-option.selected {
            border-color: var(--header-color);
            background: var(--highlight-bg);
        }
        
        .radio-option strong {
            font-size: 0.9rem;
            display: block;
            line-height: 1.3;
        }
        
        .radio-option small {
            font-size: 0.8rem;
            display: block;
            line-height: 1.3;
        }

        .results-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 25px;
            margin-top: 30px;
        }

        .result-card {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--header-color);
        }

        #mainResult{
  text-shadow:
    /* sharp halo (this is the key) */
    0 0 1px rgba(120,165,255,0.95),

    /* soft bloom */
    0 0 12px rgba(120,165,255,0.35),
    0 0 26px rgba(120,165,255,0.18) ;
  animation: subtleGlow 3s ease-in-out infinite;
}

@keyframes subtleGlow {
  0%, 100% {
    text-shadow:
      0 0 1px rgba(120,165,255,0.95),
      0 0 12px rgba(120,165,255,0.35),
      0 0 26px rgba(120,165,255,0.18);
  }
  50% {
    text-shadow:
      0 0 2px rgba(120,165,255,1),
      0 0 16px rgba(120,165,255,0.5),
      0 0 32px rgba(120,165,255,0.28);
  }
}

.result-hero-left {
  animation: heroGlow 3s ease-in-out infinite;
}

@keyframes heroGlow {
  0%, 100% {
    box-shadow: 
      0 0 30px rgba(120,165,255,0.25), 
      0 0 60px rgba(120,165,255,0.15), 
      0 4px 12px rgba(0,0,0,0.3), 
      inset 0 1px 2px rgba(255,255,255,0.1);
  }
  50% {
    box-shadow: 
      0 0 40px rgba(120,165,255,0.35), 
      0 0 80px rgba(120,165,255,0.22), 
      0 4px 12px rgba(0,0,0,0.3), 
      inset 0 1px 2px rgba(255,255,255,0.1);
  }
}



        .result-label {
            color: #bbb;
            font-size: 0.95rem;
        }

        /* Combined Tabs and Options Row */
        .tabs-and-options-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 2px solid #555;
            padding-bottom: 8px;
        }

        .tabs {
            display: flex;
            margin-bottom: 0;
            border-bottom: none;
        }

        .tab {
            padding: 8px 14px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #bbb;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .tab:hover {
            color: white;
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .tab.active {
            color: var(--header-color);
            border-bottom-color: var(--header-color);
            background: rgba(168, 192, 231, 0.1);
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(168, 192, 231, 0.3);
        }

        .tab.switching {
            animation: tabSwitchPulse 0.8s ease;
        }

        @keyframes tabSwitchPulse {
            0% {
                transform: translateY(0);
                box-shadow: 0 4px 12px rgba(168, 192, 231, 0.3);
            }
            50% {
                transform: translateY(-4px);
                box-shadow: 0 8px 24px rgba(168, 192, 231, 0.5);
            }
            100% {
                transform: translateY(0);
                box-shadow: 0 4px 12px rgba(168, 192, 231, 0.3);
            }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--header-color);
        }

        .stat-label {
            color: #bbb;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .probability-visualization {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .shaded-area-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 10px;
            background: rgba(168, 192, 231, 0.1);
            border-radius: 6px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .shaded-area-info.updating {
            background: rgba(52, 152, 219, 0.15);
            border: 1px solid rgba(52, 152, 219, 0.3);
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.2);
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 1024px) {
            .results-row .probability-visualization {
                flex: 0 0 45%;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs-and-options-row {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .chart-options-toolbar {
                justify-content: center;
                gap: 15px;
                flex-wrap: wrap;
            }

            .option-label {
                font-size: 0.8rem;
            }

            .mini-dropdown {
                font-size: 0.75rem;
                min-width: 45px;
            }

            .results-row {
                flex-direction: column;
                gap: 15px;
            }

            .results-row .probability-visualization {
                flex: none;
            }

            .results-row .embedded-results-panel {
                flex: none;
            }

            .embedded-stats-grid {
                gap: 8px;
                justify-content: flex-start;
            }

            .embedded-stat-item {
                min-width: 45px;
                padding: 3px 4px;
            }

            .embedded-stat-item.stat-separator {
                margin-left: 10px;
                padding-left: 10px;
            }

            .embedded-stat-value {
                font-size: 1.0rem;
            }

            .embedded-stat-label {
                font-size: 0.75rem;
            }
        }

        /* Chart Options Toolbar Styles */
        .chart-options-toolbar {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .chart-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #bbb;
            font-weight: 500;
            white-space: nowrap;
        }

        .option-label i {
            font-size: 0.8rem;
            color: var(--primary-blue);
            opacity: 0.8;
        }

        .mini-dropdown {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            font-size: 0.8rem;
            min-width: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mini-dropdown:hover {
            background: rgba(255,255,255,0.12);
            border-color: var(--primary-blue);
        }

        .mini-dropdown:focus {
            outline: none;
            border-color: var(--primary-blue);
            background: rgba(52, 152, 219, 0.1);
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
        }

        .mini-dropdown option {
            background: #2c3e50;
            color: white;
            padding: 4px;
        }

        .formula-display {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            color: #e8e8e8;
            font-size: 0.95rem;
        }

        .chart-indicator {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .x-marker {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .x-marker::before {
            content: '';
            width: 3px;
            height: 20px;
            border-radius: 1px;
            opacity: 0.8;
        }

        .probability-result {
            background: linear-gradient(135deg, rgba(168, 192, 231, 0.2) 0%, rgba(148, 172, 211, 0.2) 100%);
            border: 2px solid rgba(168, 192, 231, 0.6);
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            color: rgb(120,165,255);
            text-align: center;
            min-width: 120px;
        }

        /* Results Row Layout */
        .results-row {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            align-items: stretch;
        }

        .results-row .probability-visualization {
            flex: 0 0 40%;
            margin-top: 0;
        }

        .results-row .embedded-results-panel {
            flex: 1;
            margin-top: 0;
        }

        /* Embedded Results Panel Styles - Small Horizontal Boxes */
        .embedded-results-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .embedded-panel-title {
            font-size: 0.85rem;
            color: var(--header-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .embedded-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            justify-content: center;
        }
        
        .embedded-stats-grid .embedded-stat-item:nth-child(1) {
            grid-column: 1 / 2;
        }
        
        .embedded-stats-grid .embedded-stat-item:nth-child(2) {
            grid-column: 2 / 4;
        }

        .embedded-stat-item {
            background: rgba(255,255,255,0.08);
            padding: 6px 8px;
            border-radius: 4px;
            text-align: center;
            min-width: 70px;
            flex: 0 0 auto;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }

        .embedded-stat-item.updating {
            transform: scale(1.05) translateY(-2px);
            background: rgba(52, 152, 219, 0.2);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3);
        }

        .embedded-stat-item:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .embedded-stat-item.primary-result {
            background: rgba(168, 192, 231, 0.15);
            border: 1px solid rgba(168, 192, 231, 0.3);
            min-width: 65px;
        }

        .embedded-stat-item.primary-result:hover {
            background: rgba(168, 192, 231, 0.25);
            box-shadow: 0 4px 16px rgba(168, 192, 231, 0.3);
        }

        .embedded-stat-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--header-color);
            line-height: 1.1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .embedded-stat-value.animating {
            color: rgb(255,165,120);
            transform: scale(1.1);
            text-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
        }

        .embedded-stat-item.primary-result .embedded-stat-value {
            color: rgb(120,165,255);
        }

        .embedded-stat-item.stat-separator {
            margin-left: 16px;
            padding-left: 16px;
            border-left: 2px solid rgba(255,255,255,0.15);
        }

        .embedded-stat-label {
            color: #bbb;
            font-size: 0.85rem;
            margin-top: 1px;
            line-height: 1;
            transition: color 0.3s ease;
        }

        /* Chart animation enhancements */
        .chart-container {
            position: relative;
            height: 100%;
            flex: 1;
            margin-top: 10px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 250px;
        }

        .chart-container > div {
            transition: opacity 0.3s ease;
        }

        .chart-container.animating {
            transform: scale(1.02);
            box-shadow: 0 8px 32px rgba(52, 152, 219, 0.3);
            border-radius: 12px;
        }

        /* Highcharts specific styling for dark theme */
        .highcharts-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
        }

        .highcharts-background {
            fill: transparent !important;
        }

        .highcharts-title {
            fill: white !important;
        }

        .highcharts-subtitle {
            fill: #bbb !important;
        }

        .highcharts-axis-labels text {
            fill: white !important;
        }

        .highcharts-axis-title {
            fill: white !important;
        }

        .highcharts-legend-item text {
            fill: white !important;
        }

        .highcharts-plot-line-label {
            color: white !important;
        }

        /* Animated chart indicators */
        .chart-indicator {
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .x-marker {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(20px);
            }
            50% {
                opacity: 1;
                transform: scale(1.05) translateY(-5px);
            }
            70% {
                transform: scale(0.95) translateY(2px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Tab switching animations */
        .tab-content {
            opacity: 0;
            transform: translateX(20px);
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .tab-content.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
            animation: tabSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes tabSlideIn {
            0% {
                opacity: 0;
                transform: translateX(30px) scale(0.95);
            }
            50% {
                opacity: 0.7;
                transform: translateX(10px) scale(0.98);
            }
            100% {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .tab {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab:hover {
            transform: translateY(-1px);
        }

        .tab.active {
            transform: translateY(0);
        }

        /* Reset animation effects */
        .resetting {
            animation: resetPulse 0.8s ease-in-out;
        }

        @keyframes resetPulse {
            0% {
                transform: scale(1);
                background: rgba(255,255,255,0.08);
            }
            25% {
                transform: scale(1.05);
                background: rgba(39, 174, 96, 0.2);
            }
            50% {
                transform: scale(1.02);
                background: rgba(39, 174, 96, 0.15);
            }
            75% {
                transform: scale(1.01);
                background: rgba(39, 174, 96, 0.1);
            }
            100% {
                transform: scale(1);
                background: rgba(255,255,255,0.08);
            }
        }

        .btn-success {
            position: relative;
            overflow: hidden;
        }

        .btn-success::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-success:hover::before {
            left: 100%;
        }

        /* Loading pulse effect for calculations */
        .calculating {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Force-visible, semantic micro-glow on the main numeric result */


    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div style="width: 100vw; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center;">
        <div id="mainContentWrapper" style="width: 90%; max-width: 1200px; height: auto;">
            <div class="container">
                <div class="header">
                    <h1>
                        <i class="fas fa-coins"></i>
                        Binomial Distribution Calculator
                    </h1>

                </div>
                <div class="main-content">
<!-- RESULT-FIRST HERO -->
<div class="result-hero">
    <div style="width: 100%; margin: 0 0 8px 0; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: space-between;">
        <h3 style="margin: 0; color: var(--header-color); font-size: 1.1rem; font-weight: 600;">
            <i class="fas fa-chart-line"></i> Results
        </h3>
        <div class="chart-option" style="margin: 0;">
            <label for="precision" class="option-label" style="margin-right: 6px; font-size: 0.85rem;">
                <i class="fas fa-decimal"></i>
                Precision
            </label>
            <select class="mini-dropdown" id="precision" style="font-size: 0.85rem;">
                <option value="2">2</option>
                <option selected value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
            </select>
        </div>
    </div>
    <div class="result-hero-left" style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,165,120,0.3); border-radius: 12px; padding: 12px; text-align: center; align-items: center;">
        <div class="result-hero-label" style="justify-content: center; font-size: 0.85rem;">
            <span id="heroExpression">Result</span>
            <small>(updates instantly)</small>
        </div>

        <div class="result-hero-value" id="mainResult" style="text-align: center;">--</div>

        <div class="shaded-area-info" style="margin: 0; text-align: center; font-size: 0.9rem;">
            <div style="text-align: center;">
                <span id="areaValue" style="font-weight: 800; color: rgb(120,165,255); text-shadow: 0 6px 22px rgba(120,165,255,0.25); display: inline-block;">--</span>
            </div>
        </div>

        <div style="margin-top: 8px; text-align: center;">
            <span id="explanationLine" style="font-size: 0.8rem; color: rgba(255,255,255,0.6); font-style: italic;">Select parameters to calculate</span>
        </div>

        <div class="result-hero-actions" style="justify-content: center;">


        </div>
    </div>

    <div class="result-hero-right">
        <div class="result-hero-card">
            <h4><i class="fas fa-chart-bar"></i> Summary Statistics</h4>
            <div class="embedded-results-panel">
                <div class="embedded-stats-grid">
                    <div class="embedded-stat-item">
                        <div class="embedded-stat-value" id="nStat">10</div>
                        <div class="embedded-stat-label">n (Trials)</div>
                    </div>
                    <div class="embedded-stat-item">
                        <div class="embedded-stat-value" id="pStat">0.5</div>
                        <div class="embedded-stat-label">p (Success)</div>
                    </div>
                    <div class="embedded-stat-item">
                        <div class="embedded-stat-value" id="meanStat">5</div>
                        <div class="embedded-stat-label">Mean</div>
                    </div>
                    <div class="embedded-stat-item">
                        <div class="embedded-stat-value" id="varianceStat">2.5</div>
                        <div class="embedded-stat-label">Variance</div>
                    </div>
                    <div class="embedded-stat-item">
                        <div class="embedded-stat-value" id="stddevStat">1.58</div>
                        <div class="embedded-stat-label">Std Dev</div>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

                    <div class="control-panel">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h3 class="panel-title" style="margin-bottom: 0;">
                                <i class="fas fa-edit"></i>
                                Inputs
                            </h3>
                            <button class="btn btn-success" onclick="reloadCalculator()" style="padding: 6px 10px; font-size: 0.8rem;">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                        </div>
                        <div class="input-group">
                            <label>
                                Number of Trials (n)
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Positive integer (1, 2, 3, ...)</small>
                            </label>
                            <div class="input-row">
                                <input class="input-field" id="nTrials" min="1" step="1" type="number" value="10" placeholder="e.g., 5, 10, 20"/>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>
                                Probability of Success (p)
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Between 0 and 1 (e.g., 0.5 = 50%)</small>
                            </label>
                            <div class="input-row">
                                <input class="input-field" id="pSuccess" min="0" max="1" step="0.01" type="number" value="0.5" placeholder="e.g., 0.3, 0.5, 0.7"/>
                            </div>
                        </div>
                        <div class="calculation-type">
                            <h4 style="margin-bottom: 10px; color: var(--header-color); font-size: 0.95rem;">
                                Calculation Type
                            </h4>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input checked="" name="calcType" type="radio" value="probability"/>
                                    <div>
                                        <strong>Find P(X = k)</strong>
                                        <small style="color: #bbb; display: block; margin-top: 2px;">Probability of exactly k successes</small>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input name="calcType" type="radio" value="cumulative"/>
                                    <div>
                                        <strong>Find P(X ≤ k)</strong>
                                        <small style="color: #bbb; display: block; margin-top: 2px;">Probability of k or fewer successes</small>
                                    </div>
                                </label>
                                <label class="radio-option">
                                    <input name="calcType" type="radio" value="between"/>
                                    <div>
                                        <strong>Find P(a ≤ X ≤ b)</strong>
                                        <small style="color: #bbb; display: block; margin-top: 2px;">Probability between a and b successes</small>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div id="inputSection">
                            <div class="input-group">
                                <label>
                                    k Value (number of successes)
                                </label>
                                <input class="input-field" id="kValue" min="0" step="1" type="number" value="5"/>
                            </div>
                        </div>
                          <!-- About Section Toggle Button -->
                        <div style="margin: 15px -18px -18px -18px; padding: 12px 18px 18px 18px; border-top: 1px solid rgba(120,165,255,0.2); text-align: center;">
                            <button onclick="toggleAboutSection()" style="
                                width: 80%;
                                background: linear-gradient(135deg, rgba(120,165,255,0.2), rgba(120,200,255,0.15));
                                border: 1px solid rgba(120,165,255,0.4);
                                color: rgb(120,200,255);
                                padding: 8px 16px;
                                border-radius: 8px;
                                font-size: 0.9rem;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                font-weight: 600;
                                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                            " onmouseover="this.style.background='linear-gradient(135deg, rgba(120,165,255,0.3), rgba(120,200,255,0.25))'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(120,165,255,0.3)'" onmouseout="this.style.background='linear-gradient(135deg, rgba(120,165,255,0.2), rgba(120,200,255,0.15))'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)'">
                                <i class="fas fa-info-circle"></i> About Binomial Distribution...
                            </button>
                        </div>
                    </div>
                    <div class="visualization-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-chart-area"></i>
                            Visualizations
                        </h3>
                        <!-- Combined Tabs and Chart Options Row -->
                        <div class="tabs-and-options-row">
                            <!-- Tabs on the Left -->
                            <div class="tabs">
                                <div class="tab active" onclick="switchTab('pmf', this)">
                                    PMF View
                                </div>
                                <div class="tab" onclick="switchTab('cdf', this)">
                                    CDF View
                                </div>
                                <div class="tab" onclick="switchTab('both', this)">
                                    Combined View
                                </div>
                            </div>

                            <!-- Chart Options on the Right -->
                            <div class="chart-options-toolbar">
                                <div class="chart-option">
                                    <label for="chartRange" class="option-label">
                                        <i class="fas fa-expand-arrows-alt"></i>
                                        Range
                                    </label>
                                    <select class="mini-dropdown" id="chartRange">
                                        <option value="full">Full (0-n)</option>
                                        <option selected value="centered">Centered</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="tab-content active" id="pmfTab">
                            <div class="chart-container">
                                <div id="pmfChart"></div>
                            </div>
                        </div>
                        <div class="tab-content" id="cdfTab">
                            <div class="chart-container">
                                <div id="cdfChart"></div>
                            </div>
                        </div>
                        <div class="tab-content" id="bothTab">
                            <div class="chart-container">
                                <div id="combinedChart"></div>
                            </div>
                        </div>

<!-- Result/Stats moved to Result Hero -->



</div>

                            <!-- Embedded Results & Statistics Panel -->

<!-- Results & Statistics moved to Result Hero -->

                        </div>
                    </div>
                </div>

                <!-- About Section Modal (Hidden by default) -->
                <div id="aboutSection" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; overflow-y: auto; backdrop-filter: blur(5px);">
                    <div style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
                        <div style="background: linear-gradient(135deg, #1a2332, #0f1621); border-radius: 16px; border: 1px solid rgba(120,165,255,0.3); box-shadow: 0 20px 60px rgba(0,0,0,0.5); padding: 40px; position: relative;">
                            <!-- Close Button -->

                            <button onclick="toggleAboutSection()" style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.8); width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='rotate(90deg)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='rotate(0deg)'">
                                <i class="fas fa-times"></i>
                            </button>

                            <h2 style="color: var(--header-color); margin-bottom: 25px; font-size: 1.8rem; text-align: center; padding-right: 40px;">
                                <i class="fas fa-chart-bar"></i> About the Binomial Distribution
                            </h2>

                    <div style="color: rgba(255,255,255,0.85); line-height: 1.9; font-size: 1rem;">
                        <!-- Definition -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-book"></i> Definition
                        </h3>
                        <p style="margin-bottom: 20px;">
                            The <strong>binomial distribution</strong> is a discrete probability distribution that models the number of successes
                            in a fixed number of independent Bernoulli trials, where each trial has only two possible outcomes (success or failure)
                            and the same probability of success. It is one of the most widely used probability distributions in statistics.
                        </p>

                        <!-- Key Properties -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-cogs"></i> Key Properties
                        </h3>
                        <p style="margin-bottom: 15px;">A random variable X follows a binomial distribution if:</p>
                        <ul style="margin-left: 25px; margin-bottom: 20px; line-height: 2;">
                            <li>There is a <strong>fixed number of trials</strong> (n)</li>
                            <li>Each trial is <strong>independent</strong> of the others</li>
                            <li>Each trial has only <strong>two possible outcomes</strong>: success or failure</li>
                            <li>The <strong>probability of success</strong> (p) is the same for each trial</li>
                            <li>We count the <strong>total number of successes</strong> (k) across all trials</li>
                        </ul>

                        <!-- Parameters -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-sliders-h"></i> Parameters
                        </h3>
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; border-left: 4px solid rgb(120,200,255); margin-bottom: 20px;">
                            <p style="margin-bottom: 12px;"><strong>n</strong> (number of trials): A positive integer representing the fixed number of independent trials</p>
                            <p style="margin-bottom: 12px;"><strong>p</strong> (probability of success): A value between 0 and 1 (inclusive) representing the probability of success on each individual trial</p>
                            <p style="margin-bottom: 0;"><strong>k</strong> (number of successes): A non-negative integer ≤ n, representing the number of successful outcomes we're interested in</p>
                        </div>

                        <!-- Formulas -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-calculator"></i> Mathematical Formulas
                        </h3>
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <p style="margin-bottom: 15px;"><strong>Probability Mass Function (PMF):</strong></p>
                            <p style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; font-size: 1.05rem; margin-bottom: 20px;">
                                P(X = k) = C(n, k) × p<sup>k</sup> × (1-p)<sup>n-k</sup>
                            </p>
                            <p style="margin-bottom: 10px;">where C(n, k) = n! / (k! × (n-k)!) is the binomial coefficient</p>

                            <p style="margin-bottom: 15px; margin-top: 25px;"><strong>Cumulative Distribution Function (CDF):</strong></p>
                            <p style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; font-size: 1.05rem; margin-bottom: 20px;">
                                P(X ≤ k) = Σ<sub>i=0</sub><sup>k</sup> C(n, i) × p<sup>i</sup> × (1-p)<sup>n-i</sup>
                            </p>

                            <p style="margin-bottom: 10px; margin-top: 25px;"><strong>Mean (Expected Value):</strong></p>
                            <p style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; font-size: 1.05rem; margin-bottom: 20px;">
                                E[X] = μ = n × p
                            </p>

                            <p style="margin-bottom: 10px;"><strong>Variance:</strong></p>
                            <p style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; font-size: 1.05rem; margin-bottom: 20px;">
                                Var(X) = σ² = n × p × (1-p)
                            </p>

                            <p style="margin-bottom: 10px;"><strong>Standard Deviation:</strong></p>
                            <p style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; font-size: 1.05rem; margin-bottom: 0;">
                                σ = √[n × p × (1-p)]
                            </p>
                        </div>

                        <!-- Real-World Applications -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-globe"></i> Real-World Applications
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="background: rgba(120,165,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(120,165,255,0.2);">
                                <strong style="color: rgb(255,165,120);">🏭 Quality Control</strong>
                                <p style="margin-top: 8px; font-size: 0.95rem;">Testing defective items in a production batch where each item has a fixed probability of being defective</p>
                            </div>
                            <div style="background: rgba(120,165,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(120,165,255,0.2);">
                                <strong style="color: rgb(255,165,120);">🧬 Genetics</strong>
                                <p style="margin-top: 8px; font-size: 0.95rem;">Mendelian inheritance patterns, predicting offspring traits based on parent genotypes</p>
                            </div>
                            <div style="background: rgba(120,165,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(120,165,255,0.2);">
                                <strong style="color: rgb(255,165,120);">💊 Clinical Trials</strong>
                                <p style="margin-top: 8px; font-size: 0.95rem;">Number of patients responding to treatment in a fixed-size trial group</p>
                            </div>
                            <div style="background: rgba(120,165,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(120,165,255,0.2);">
                                <strong style="color: rgb(255,165,120);">📊 A/B Testing</strong>
                                <p style="margin-top: 8px; font-size: 0.95rem;">Conversion rates in digital marketing, comparing success rates between variants</p>
                            </div>
                            <div style="background: rgba(120,165,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(120,165,255,0.2);">
                                <strong style="color: rgb(255,165,120);">🎲 Gaming & Gambling</strong>
                                <p style="margin-top: 8px; font-size: 0.95rem;">Probability of winning k times in n independent games or bets</p>
                            </div>
                            <div style="background: rgba(120,165,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(120,165,255,0.2);">
                                <strong style="color: rgb(255,165,120);">📋 Survey Sampling</strong>
                                <p style="margin-top: 8px; font-size: 0.95rem;">Proportion of respondents with a particular characteristic in a random sample</p>
                            </div>
                        </div>

                        <!-- Examples -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-lightbulb"></i> Practical Examples
                        </h3>
                        <div style="background: rgba(255,165,120,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid rgb(255,165,120); margin-bottom: 15px;">
                            <p style="margin-bottom: 10px;"><strong>Example 1: Coin Flips</strong></p>
                            <p>If you flip a fair coin 10 times (n=10, p=0.5), what's the probability of getting exactly 5 heads?
                            This is P(X = 5) ≈ 0.246 or 24.6%.</p>
                        </div>
                        <div style="background: rgba(255,165,120,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid rgb(255,165,120); margin-bottom: 15px;">
                            <p style="margin-bottom: 10px;"><strong>Example 2: Free Throws</strong></p>
                            <p>A basketball player makes 70% of free throws (p=0.7). In 20 attempts (n=20), what's the probability they make
                            at least 15? Calculate P(X ≥ 15) = 1 - P(X ≤ 14).</p>
                        </div>
                        <div style="background: rgba(255,165,120,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid rgb(255,165,120); margin-bottom: 20px;">
                            <p style="margin-bottom: 10px;"><strong>Example 3: Quality Control</strong></p>
                            <p>A factory produces items with a 5% defect rate (p=0.05). In a batch of 100 items (n=100), what's the probability
                            of finding between 3 and 7 defective items? Calculate P(3 ≤ X ≤ 7).</p>
                        </div>

                        <!-- When to Use -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-question-circle"></i> When to Use Binomial Distribution
                        </h3>
                        <p style="margin-bottom: 15px;">Use the binomial distribution when:</p>
                        <ul style="margin-left: 25px; margin-bottom: 20px; line-height: 2;">
                            <li>✅ You have a <strong>fixed number of trials</strong></li>
                            <li>✅ Each trial is <strong>independent</strong></li>
                            <li>✅ Each trial has exactly <strong>two outcomes</strong></li>
                            <li>✅ The probability of success is <strong>constant</strong> across trials</li>
                            <li>✅ You're counting the <strong>number of successes</strong></li>
                        </ul>

                        <p style="margin-bottom: 15px; margin-top: 25px;"><strong>Don't use binomial distribution when:</strong></p>
                        <ul style="margin-left: 25px; margin-bottom: 20px; line-height: 2;">
                            <li>❌ The number of trials is not fixed or is very large (use Poisson or normal approximation)</li>
                            <li>❌ Trials are not independent (use hypergeometric distribution)</li>
                            <li>❌ Probability of success changes between trials</li>
                            <li>❌ You're measuring continuous outcomes (use normal or other continuous distributions)</li>
                        </ul>

                        <!-- Normal Approximation -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-exchange-alt"></i> Normal Approximation
                        </h3>
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <p style="margin-bottom: 15px;">
                                When n is large, the binomial distribution can be approximated by a normal distribution with:
                            </p>
                            <p style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                                μ = np &nbsp;&nbsp;&nbsp;&nbsp; σ = √[np(1-p)]
                            </p>
                            <p style="margin-bottom: 10px;">
                                <strong>Rule of thumb:</strong> Use normal approximation when both np ≥ 5 and n(1-p) ≥ 5
                            </p>
                            <p style="margin-bottom: 0;">
                                <strong>Continuity correction:</strong> For better accuracy, add or subtract 0.5 when using normal approximation
                            </p>
                        </div>

                        <!-- Additional Resources -->
                        <h3 style="color: rgb(120,200,255); margin-top: 30px; margin-bottom: 15px; font-size: 1.3rem;">
                            <i class="fas fa-link"></i> Related Distributions
                        </h3>
                        <ul style="margin-left: 25px; line-height: 2;">
                            <li><strong>Bernoulli Distribution:</strong> Special case of binomial with n=1</li>
                            <li><strong>Poisson Distribution:</strong> Limit of binomial as n→∞, p→0, np=λ constant</li>
                            <li><strong>Negative Binomial:</strong> Models number of trials until r successes</li>
                            <li><strong>Hypergeometric Distribution:</strong> Like binomial but for sampling without replacement</li>
                        </ul>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button onclick="toggleAboutSection()" style="
                            background: linear-gradient(135deg, rgba(120,165,255,0.2), rgba(120,200,255,0.15));
                            border: 1px solid rgba(120,165,255,0.3);
                            color: rgb(120,200,255);
                            padding: 12px 28px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 1rem;
                            font-weight: 600;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='linear-gradient(135deg, rgba(120,165,255,0.3), rgba(120,200,255,0.25))'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='linear-gradient(135deg, rgba(120,165,255,0.2), rgba(120,200,255,0.15))'; this.style.transform='translateY(0)'">
                            <i class="fas fa-check"></i> Got it!
                        </button>
                    </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script>
        let pmfChart, cdfChart, combinedChart;
        let currentCalcType = 'probability';

        // Store chart data for animations
        let chartDataStore = {
            pmfData: [],
            cdfData: [],
            highlightedData: []
        };

        // Track if this is initial load to prevent double animation
        let isInitialLoad = true;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Highcharts to load
            if (typeof Highcharts === 'undefined') {
                setTimeout(() => {
                    initializeApp();
                }, 100);
            } else {
                initializeApp();
            }
        });

        function initializeApp() {
            try {
                initializeCharts();
                updateInputSection();
                updateRadioSelection();
                updateStatistics();
                calculate();

                // Trigger initial curve building animation for PMF view (active by default)
                setTimeout(() => {
                    if (pmfChart && chartDataStore.pmfData.length > 0) {
                        triggerChartAnimations('pmf');
                    }
                }, 800); // Delay to ensure all data is ready

                // Add event listeners with visual feedback
                document.getElementById('nTrials').addEventListener('input', debounce(calculateWithFeedback, 250));
                document.getElementById('pSuccess').addEventListener('input', debounce(calculateWithFeedback, 250));
                document.getElementById('chartRange').addEventListener('change', debounce(calculateWithFeedback, 250));
                document.getElementById('precision').addEventListener('change', debounce(calculateWithFeedback, 250));

                // Add event listener to initial k value input
                const initialKValue = document.getElementById('kValue');
                if (initialKValue) {
                    initialKValue.addEventListener('input', debounce(calculateWithFeedback, 250));
                }

                document.querySelectorAll('input[name="calcType"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        currentCalcType = this.value;
                        updateInputSection();
                        updateRadioSelection();
                        calculateWithFeedback();
                    });
                });

                // Add keyboard shortcuts
                document.addEventListener('keydown', function(e) {
                    // Ctrl+R or Cmd+R for reload (prevent default browser reload)
                    if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                        e.preventDefault();
                        reloadCalculator();
                    }
                    // F5 for reload
                    if (e.key === 'F5') {
                        e.preventDefault();
                        reloadCalculator();
                    }
                });

            } catch (error) {
                console.error('Initialization error:', error);
                // Fallback: show error message
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) mainResultEl.textContent = 'Loading...';
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateRadioSelection() {
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`input[value="${currentCalcType}"]`).closest('.radio-option').classList.add('selected');
        }

        function updateInputSection() {
            const inputSection = document.getElementById('inputSection');
            const calcType = document.querySelector('input[name="calcType"]:checked').value;

            let html = '';

            switch(calcType) {
                case 'probability':
                    html = `
                        <div class="input-group">
                            <label>k Value (number of successes)
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Non-negative integer ≤ n</small>
                            </label>
                            <input type="number" id="kValue" class="input-field" value="5" step="1" min="0" placeholder="e.g., 0, 1, 5, 10">
                        </div>
                    `;
                    break;
                case 'cumulative':
                    html = `
                        <div class="input-group">
                            <label>k Value (maximum successes)
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Non-negative integer ≤ n</small>
                            </label>
                            <input type="number" id="kValue" class="input-field" value="5" step="1" min="0" placeholder="e.g., 0, 1, 5, 10">
                        </div>
                    `;
                    break;
                case 'between':
                    html = `
                        <div class="input-group">
                            <label style="margin-bottom: 8px; display: block;">Bounds (a ≤ X ≤ b)
                                <small style="color: #bbb; font-weight: normal; display: block; margin-top: 2px;">Non-negative integers ≤ n</small>
                            </label>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <input type="number" id="lowerBound" class="input-field" value="3" step="1" min="0" placeholder="Lower" style="flex: 1;">
                                <span style="color: #bbb; font-weight: bold;">≤ X ≤</span>
                                <input type="number" id="upperBound" class="input-field" value="7" step="1" min="0" placeholder="Upper" style="flex: 1;">
                            </div>
                        </div>
                    `;
                    break;
            }

            inputSection.innerHTML = html;

            // Add event listeners to new inputs
            inputSection.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', debounce(calculateWithFeedback, 250));
            });
        }

        function initializeCharts() {
            try {
                if (typeof Highcharts === 'undefined') {
                    console.error('Highcharts not loaded');
                    return;
                }

                // Set dark theme for all charts
                Highcharts.setOptions({
                    chart: {
                        backgroundColor: 'transparent',
                        style: {
                            fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif'
                        }
                    },
                    colors: ['rgba(108, 142, 191, 0.2)', '#27ae60', '#e74c3c', '#f39c12', '#9b59b6'],
                    title: {
                        style: {
                            color: 'white'
                        }
                    },
                    xAxis: {
                        gridLineColor: 'rgba(255,255,255,0.1)',
                        lineColor: 'rgba(255,255,255,0.3)',
                        tickColor: 'rgba(255,255,255,0.3)',
                        labels: {
                            style: {
                                color: 'white'
                            }
                        },
                        title: {
                            style: {
                                color: 'white'
                            }
                        }
                    },
                    yAxis: {
                        gridLineColor: 'rgba(255,255,255,0.1)',
                        lineColor: 'rgba(255,255,255,0.3)',
                        tickColor: 'rgba(255,255,255,0.3)',
                        labels: {
                            style: {
                                color: 'white'
                            }
                        },
                        title: {
                            style: {
                                color: 'white'
                            }
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        column: {
                            marker: {
                                enabled: false
                            }
                        }
                    }
                });

                // PMF Chart (using column chart for discrete distribution)
                pmfChart = Highcharts.chart('pmfChart', {
                    chart: {
                        type: 'column',
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        title: {
                            text: 'k (Number of Successes)'
                        },
                        tickInterval: 1
                    },
                    yAxis: {
                        title: {
                            text: 'Probability'
                        },
                        min: 0
                    },
                    series: [{
                        name: 'P(X = k)',
                        data: [],
                        color: 'rgba(108, 142, 191, 0.2)',
                        borderWidth: 1,
                        borderColor: 'rgba(108, 142, 191, 0.9)',
                        dataLabels: {
                            enabled: true,
                            rotation: 0,
                            color: '#FFFFFF',
                            align: 'center',
                            y: -10,
                            style: {
                                fontSize: '10px',
                                fontWeight: 'bold',
                                textOutline: '1px rgba(0,0,0,0.5)'
                            },
                            formatter: function() {
                                const precision = parseInt(document.getElementById('precision')?.value) || 2;
                                return this.y.toFixed(precision);
                            }
                        }
                    }, {
                        name: 'Highlighted',
                        data: [],
                        color: '#9b59b6',
                        opacity: 0.85,
                        borderWidth: 2,
                        borderColor: '#8e44ad',
                        dataLabels: {
                            enabled: true,
                            rotation: 0,
                            color: '#FFFFFF',
                            align: 'center',
                            y: -10,
                            style: {
                                fontSize: '10px',
                                fontWeight: 'bold',
                                textOutline: '1px rgba(0,0,0,0.7)'
                            },
                            formatter: function() {
                                const precision = parseInt(document.getElementById('precision')?.value) || 2;
                                return this.y.toFixed(precision);
                            }
                        }
                    }],
                    tooltip: {
                        shared: false,
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        style: {
                            color: 'white'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    }
                });

                // CDF Chart
                cdfChart = Highcharts.chart('cdfChart', {
                    chart: {
                        type: 'line',
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        title: {
                            text: 'k (Number of Successes)'
                        },
                        tickInterval: 1
                    },
                    yAxis: {
                        title: {
                            text: 'P(X ≤ k)'
                        },
                        min: 0,
                        max: 1
                    },
                    series: [{
                        name: 'Cumulative Probability',
                        data: [],
                        color: '#27ae60',
                        lineWidth: 3,
                        shadow: true,
                        step: 'left'
                    }],
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        style: {
                            color: 'white'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    }
                });

                // Combined Chart
                combinedChart = Highcharts.chart('combinedChart', {
                    chart: {
                        type: 'column',
                        animation: {
                            duration: 800,
                            easing: 'easeOutQuart'
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        title: {
                            text: 'k (Number of Successes)'
                        },
                        tickInterval: 1
                    },
                    yAxis: [{
                        title: {
                            text: 'PMF',
                            style: {
                                color: 'rgb(255,165,120)'
                            }
                        },
                        min: 0,
                        labels: {
                            style: {
                                color: 'rgb(255,165,120)'
                            }
                        }
                    }, {
                        title: {
                            text: 'CDF',
                            style: {
                                color: '#27ae60'
                            }
                        },
                        min: 0,
                        max: 1,
                        opposite: true,
                        labels: {
                            style: {
                                color: '#27ae60'
                            }
                        }
                    }],
                    series: [{
                        name: 'PMF',
                        data: [],
                        type: 'column',
                        color: 'rgba(108, 142, 191, 0.2)',
                        yAxis: 0,
                        borderWidth: 1,
                        borderColor: 'rgba(108, 142, 191, 0.9)',
                        dataLabels: {
                            enabled: true,
                            rotation: 0,
                            color: '#FFFFFF',
                            align: 'center',
                            y: -10,
                            style: {
                                fontSize: '10px',
                                fontWeight: 'bold',
                                textOutline: '1px rgba(0,0,0,0.5)'
                            },
                            formatter: function() {
                                const precision = parseInt(document.getElementById('precision')?.value) || 2;
                                return this.y.toFixed(precision);
                            }
                        }
                    }, {
                        name: 'CDF',
                        data: [],
                        type: 'line',
                        color: 'rgb(255,165,120)',
                        lineWidth: 3,
                        yAxis: 1,
                        step: 'left'
                    }],
                    tooltip: {
                        shared: false,
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        style: {
                            color: 'white'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    }
                });

            } catch (error) {
                console.error('Chart initialization error:', error);
            }
        }

        // Binomial distribution functions using jStat library
        function binomialPMF(k, n, p) {
            if (typeof jStat === 'undefined') {
                console.error('jStat library not loaded');
                return NaN;
            }
            return jStat.binomial.pdf(k, n, p);
        }

        function binomialCDF(k, n, p) {
            if (typeof jStat === 'undefined') {
                console.error('jStat library not loaded');
                return NaN;
            }
            return jStat.binomial.cdf(k, n, p);
        }

        function calculateWithFeedback() {
            // Add visual feedback to input fields (only visible ones)
            const inputFields = document.querySelectorAll('.input-field:not([style*="display: none"])');
            inputFields.forEach(field => {
                field.classList.add('updating');
                setTimeout(() => field.classList.remove('updating'), 600);
            });

            // Call main calculate function
            calculate();
        }

        function calculate() {
            try {
                const n = parseInt(document.getElementById('nTrials')?.value) || 10;
                const p = parseFloat(document.getElementById('pSuccess')?.value) || 0.5;
                const precision = parseInt(document.getElementById('precision')?.value) || 4;
                const calcType = document.querySelector('input[name="calcType"]:checked').value;

                if (n <= 0) {
                    const mainResultEl = document.getElementById('mainResult');
                    if (mainResultEl) mainResultEl.textContent = 'Error: Number of trials must be positive';
                    return;
                }

                if (p < 0 || p > 1) {
                    const mainResultEl = document.getElementById('mainResult');
                    if (mainResultEl) mainResultEl.textContent = 'Error: Probability must be between 0 and 1';
                    return;
                }

                let result, areaDescription, explanation;

                switch(calcType) {
                    case 'probability':
                        const kValue = parseInt(document.getElementById('kValue')?.value) || 5;
                        if (kValue < 0 || kValue > n) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = `Error: k must be between 0 and ${n}`;
                            return;
                        }
                        result = binomialPMF(kValue, n, p);
                        areaDescription = `P(X = ${kValue})`;
                        explanation = `Probability of exactly ${kValue} success${kValue !== 1 ? 'es' : ''} in ${n} trial${n !== 1 ? 's' : ''}`;
                        break;

                    case 'cumulative':
                        const kValueCum = parseInt(document.getElementById('kValue')?.value) || 5;
                        if (kValueCum < 0 || kValueCum > n) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = `Error: k must be between 0 and ${n}`;
                            return;
                        }
                        result = binomialCDF(kValueCum, n, p);
                        areaDescription = `P(X ≤ ${kValueCum})`;
                        explanation = `Probability of ${kValueCum} or fewer successes in ${n} trial${n !== 1 ? 's' : ''}`;
                        break;

                    case 'between':
                        const lowerBound = parseInt(document.getElementById('lowerBound')?.value) || 3;
                        const upperBound = parseInt(document.getElementById('upperBound')?.value) || 7;
                        if (lowerBound < 0 || upperBound < 0 || lowerBound > n || upperBound > n) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = `Error: Bounds must be between 0 and ${n}`;
                            return;
                        }
                        if (lowerBound > upperBound) {
                            const mainResultEl = document.getElementById('mainResult');
                            if (mainResultEl) mainResultEl.textContent = 'Error: Lower bound must be ≤ upper bound';
                            return;
                        }
                        const lowerProb = lowerBound > 0 ? binomialCDF(lowerBound - 1, n, p) : 0;
                        const upperProb = binomialCDF(upperBound, n, p);
                        result = upperProb - lowerProb;
                        areaDescription = `P(${lowerBound} ≤ X ≤ ${upperBound})`;
                        explanation = `Probability of ${lowerBound} to ${upperBound} successes in ${n} trial${n !== 1 ? 's' : ''}`;
                        break;
                }

                // Validate probability result
                if (!isFinite(result) || result < 0 || result > 1) {
                    console.warn('Invalid probability result:', result);
                    result = Math.min(1.0, Math.max(0.0, result || 0));
                }

                // Add updating visual feedback to area info
                const areaInfoEl = document.querySelector('.shaded-area-info');
                if (areaInfoEl) {
                    areaInfoEl.classList.add('updating');
                    setTimeout(() => areaInfoEl.classList.remove('updating'), 1000);
                }

                // Update elements with animated transitions and staggered timing
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) {
                    animateNumber(mainResultEl, mainResultEl.textContent, result, 800);
                }
                // Update result-hero expression label
                const heroExpressionEl = document.getElementById('heroExpression');
                if (heroExpressionEl) heroExpressionEl.textContent = areaDescription;


                const areaValueEl = document.getElementById('areaValue');
                if (areaValueEl) {
                    // Display only percentage with 1 decimal place
                    const percentValue = (result * 100).toFixed(1);
                    areaValueEl.textContent = `(${percentValue}%)`;
                }

                const explanationLineEl = document.getElementById('explanationLine');
                if (explanationLineEl && explanation) {
                    explanationLineEl.textContent = explanation;
                }

                updateStatistics();
                updateCharts();

                // After first calculation, mark as no longer initial load
                if (isInitialLoad) {
                    isInitialLoad = false;
                }

            } catch (error) {
                console.error('Calculation error:', error);
                const mainResultEl = document.getElementById('mainResult');
                if (mainResultEl) mainResultEl.textContent = 'Calculation Error';
            }
        }

        // Enhanced animated number counter function with visual feedback
        function animateNumber(element, startValue, endValue, duration = 800, showVisualFeedback = true) {
            if (!element) return;

            const start = performance.now();
            const startNum = parseFloat(startValue) || 0;
            const endNum = parseFloat(endValue) || 0;
            const precision = parseInt(document.getElementById('precision')?.value) || 4;

            // Add visual feedback classes
            if (showVisualFeedback) {
                element.classList.add('animating');
                const parentItem = element.closest('.embedded-stat-item');
                if (parentItem) {
                    parentItem.classList.add('updating');
                }
            }

            function updateValue(currentTime) {
                const elapsed = currentTime - start;
                const progress = Math.min(elapsed / duration, 1);

                // Use smoother easing function (ease-out-quart)
                const easedProgress = 1 - Math.pow(1 - progress, 4);

                const currentValue = startNum + (endNum - startNum) * easedProgress;
                element.textContent = currentValue.toFixed(precision);

                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                } else {
                    element.textContent = endNum.toFixed(precision);

                    // Remove visual feedback classes
                    if (showVisualFeedback) {
                        setTimeout(() => {
                            element.classList.remove('animating');
                            const parentItem = element.closest('.embedded-stat-item');
                            if (parentItem) {
                                parentItem.classList.remove('updating');
                            }
                        }, 200);
                    }
                }
            }

            requestAnimationFrame(updateValue);
        }

        // Number animation with format control (for integer vs decimal formatting)
        function animateNumberWithFormat(element, startValue, endValue, duration = 800, isInteger = false) {
            if (!element) return;

            const start = performance.now();
            const startNum = parseFloat(startValue) || 0;
            const endNum = parseFloat(endValue) || 0;
            const precision = isInteger ? 0 : (parseInt(document.getElementById('precision')?.value) || 4);

            // Add visual feedback classes
            element.classList.add('animating');
            const parentItem = element.closest('.embedded-stat-item');
            if (parentItem) {
                parentItem.classList.add('updating');
            }

            function updateValue(currentTime) {
                const elapsed = currentTime - start;
                const progress = Math.min(elapsed / duration, 1);

                // Use smoother easing function (ease-out-quart)
                const easedProgress = 1 - Math.pow(1 - progress, 4);

                const currentValue = startNum + (endNum - startNum) * easedProgress;

                if (isInteger) {
                    element.textContent = Math.round(currentValue).toString();
                } else {
                    element.textContent = currentValue.toFixed(precision);
                }

                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                } else {
                    if (isInteger) {
                        element.textContent = Math.round(endNum).toString();
                    } else {
                        element.textContent = endNum.toFixed(precision);
                    }

                    // Remove visual feedback classes
                    setTimeout(() => {
                        element.classList.remove('animating');
                        const parentItem = element.closest('.embedded-stat-item');
                        if (parentItem) {
                            parentItem.classList.remove('updating');
                        }
                    }, 200);
                }
            }

            requestAnimationFrame(updateValue);
        }

        function updateStatistics() {
            const n = parseInt(document.getElementById('nTrials')?.value) || 10;
            const p = parseFloat(document.getElementById('pSuccess')?.value) || 0.5;
            const precision = parseInt(document.getElementById('precision')?.value) || 4;

            // Binomial distribution statistics
            const mean = n * p;
            const variance = n * p * (1 - p);
            const stddev = Math.sqrt(variance);

            // Get current values for animation start points
            const statsElements = [
                { el: document.getElementById('nStat'), value: n, delay: 0, isInteger: true },
                { el: document.getElementById('pStat'), value: p, delay: 100, isInteger: false },
                { el: document.getElementById('meanStat'), value: mean, delay: 200, isInteger: false },
                { el: document.getElementById('varianceStat'), value: variance, delay: 300, isInteger: false },
                { el: document.getElementById('stddevStat'), value: stddev, delay: 400, isInteger: false }
            ];

            // Animate the value changes with staggered timing
            statsElements.forEach(({ el, value, delay, isInteger }) => {
                if (el) {
                    setTimeout(() => {
                        animateNumberWithFormat(el, el.textContent, value, 600, isInteger);
                    }, delay);
                }
            });
        }

        function updateCharts() {
            const n = parseInt(document.getElementById('nTrials')?.value) || 10;
            const p = parseFloat(document.getElementById('pSuccess')?.value) || 0.5;
            const chartRange = document.getElementById('chartRange')?.value || 'centered';
            const calcType = document.querySelector('input[name="calcType"]:checked').value;

            // Determine chart range
            let minK = 0, maxK = n;
            if (chartRange === 'centered') {
                const mean = n * p;
                const stddev = Math.sqrt(n * p * (1 - p));
                minK = Math.max(0, Math.floor(mean - 3 * stddev));
                maxK = Math.min(n, Math.ceil(mean + 3 * stddev));
            }

            const pmfData = [];
            const cdfData = [];
            const highlightedData = [];

            // Get k values for highlighting
            let highlightValues = [];
            switch(calcType) {
                case 'probability':
                    const kValue = parseInt(document.getElementById('kValue')?.value) || 5;
                    if (kValue >= 0 && kValue <= n) {
                        highlightValues = [kValue];
                    }
                    break;
                case 'cumulative':
                    const kValueCum = parseInt(document.getElementById('kValue')?.value) || 5;
                    if (kValueCum >= 0 && kValueCum <= n) {
                        highlightValues = Array.from({length: kValueCum + 1}, (_, i) => i);
                    }
                    break;
                case 'between':
                    const lowerBound = parseInt(document.getElementById('lowerBound')?.value) || 3;
                    const upperBound = parseInt(document.getElementById('upperBound')?.value) || 7;
                    if (lowerBound >= 0 && upperBound <= n && lowerBound <= upperBound) {
                        highlightValues = Array.from({length: upperBound - lowerBound + 1}, (_, i) => lowerBound + i);
                    }
                    break;
            }

            // Generate chart data
            for (let k = minK; k <= maxK; k++) {
                const pmfValue = binomialPMF(k, n, p);
                const cdfValue = binomialCDF(k, n, p);

                pmfData.push([k, pmfValue]);
                cdfData.push([k, cdfValue]);

                // Check if this k should be highlighted
                if (highlightValues.includes(k)) {
                    highlightedData.push([k, pmfValue]);
                }
            }

            // Store data globally for animations
            chartDataStore.pmfData = [...pmfData];
            chartDataStore.cdfData = [...cdfData];
            chartDataStore.highlightedData = [...highlightedData];

            // Update PMF chart
            if (pmfChart && pmfChart.series && pmfChart.series[0]) {
                try {
                    pmfChart.series[0].setData(pmfData, false);
                    if (pmfChart.series[1]) {
                        pmfChart.series[1].setData(highlightedData, false);
                    }

                    // Update X axis range
                    if (pmfChart.xAxis && pmfChart.xAxis[0]) {
                        pmfChart.xAxis[0].setExtremes(minK, maxK, false);
                    }
                } catch (error) {
                    console.warn('Error updating PMF chart data:', error);
                }

                try {
                    pmfChart.redraw();
                } catch (error) {
                    console.warn('Error redrawing PMF chart:', error);
                }
            }

            // Update CDF chart
            if (cdfChart && cdfChart.series && cdfChart.series[0]) {
                try {
                    cdfChart.series[0].setData(cdfData, false);

                    // Update X axis range
                    if (cdfChart.xAxis && cdfChart.xAxis[0]) {
                        cdfChart.xAxis[0].setExtremes(minK, maxK, false);
                    }
                } catch (error) {
                    console.warn('Error updating CDF chart data:', error);
                }

                // Add probability result annotations
                try {
                    if (cdfChart.xAxis && cdfChart.xAxis[0]) {
                        // Remove old plot lines
                        cdfChart.xAxis[0].removePlotLine('cumulative-result');
                        cdfChart.xAxis[0].removePlotLine('between-lower');
                        cdfChart.xAxis[0].removePlotLine('between-upper');
                        cdfChart.xAxis[0].removePlotLine('between-result');

                        const precision = parseInt(document.getElementById('precision')?.value) || 4;

                        if (calcType === 'cumulative') {
                            const kValueCum = parseInt(document.getElementById('kValue')?.value) || 5;
                            if (kValueCum >= minK && kValueCum <= maxK) {
                                const cumulativeResult = binomialCDF(kValueCum, n, p);

                                cdfChart.xAxis[0].addPlotLine({
                                    id: 'cumulative-result',
                                    value: kValueCum,
                                    color: '#e74c3c',
                                    width: 3,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `P(X ≤ ${kValueCum}) = ${cumulativeResult.toFixed(precision)}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold',
                                            background: 'rgba(231, 76, 60, 0.8)',
                                            padding: '4px 8px',
                                            borderRadius: '4px'
                                        },
                                        align: 'center',
                                        y: -10
                                    }
                                });
                            }
                        } else if (calcType === 'probability') {
                            const kValue = parseInt(document.getElementById('kValue')?.value) || 5;
                            if (kValue >= minK && kValue <= maxK) {
                                const probabilityResult = binomialPMF(kValue, n, p);

                                cdfChart.xAxis[0].addPlotLine({
                                    id: 'cumulative-result',
                                    value: kValue,
                                    color: '#9b59b6',
                                    width: 3,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `P(X = ${kValue}) = ${probabilityResult.toFixed(precision)}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold',
                                            background: 'rgba(155, 89, 182, 0.8)',
                                            padding: '4px 8px',
                                            borderRadius: '4px'
                                        },
                                        align: 'center',
                                        y: -10
                                    }
                                });
                            }
                        } else if (calcType === 'between') {
                            const lowerBound = parseInt(document.getElementById('lowerBound')?.value) || 3;
                            const upperBound = parseInt(document.getElementById('upperBound')?.value) || 7;

                            if (lowerBound >= minK && upperBound <= maxK && lowerBound <= upperBound) {
                                const lowerProb = lowerBound > 0 ? binomialCDF(lowerBound - 1, n, p) : 0;
                                const upperProb = binomialCDF(upperBound, n, p);
                                const betweenResult = upperProb - lowerProb;

                                // Lower bound line
                                cdfChart.xAxis[0].addPlotLine({
                                    id: 'between-lower',
                                    value: lowerBound,
                                    color: '#27ae60',
                                    width: 2,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `${lowerBound}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold'
                                        },
                                        align: 'center',
                                        y: 20
                                    }
                                });

                                // Upper bound line
                                cdfChart.xAxis[0].addPlotLine({
                                    id: 'between-upper',
                                    value: upperBound,
                                    color: '#27ae60',
                                    width: 2,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `${upperBound}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold'
                                        },
                                        align: 'center',
                                        y: 20
                                    }
                                });

                                // Result label at midpoint
                                const midpoint = (lowerBound + upperBound) / 2;
                                cdfChart.xAxis[0].addPlotLine({
                                    id: 'between-result',
                                    value: midpoint,
                                    color: 'transparent',
                                    width: 0,
                                    label: {
                                        text: `P(${lowerBound} ≤ X ≤ ${upperBound}) = ${betweenResult.toFixed(precision)}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold',
                                            background: 'rgba(39, 174, 96, 0.8)',
                                            padding: '4px 8px',
                                            borderRadius: '4px'
                                        },
                                        align: 'center',
                                        y: -10
                                    }
                                });
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Error updating CDF chart plot lines:', error);
                }

                try {
                    cdfChart.redraw();
                } catch (error) {
                    console.warn('Error redrawing CDF chart:', error);
                }
            }

            // Update combined chart
            if (combinedChart && combinedChart.series && combinedChart.series[0]) {
                try {
                    combinedChart.series[0].setData(pmfData, false);
                    if (combinedChart.series[1]) {
                        combinedChart.series[1].setData(cdfData, false);
                    }

                    // Update X axis range
                    if (combinedChart.xAxis && combinedChart.xAxis[0]) {
                        combinedChart.xAxis[0].setExtremes(minK, maxK, false);
                    }
                } catch (error) {
                    console.warn('Error updating Combined chart data:', error);
                }

                // Add probability result annotations
                try {
                    if (combinedChart.xAxis && combinedChart.xAxis[0]) {
                        // Remove old plot lines
                        combinedChart.xAxis[0].removePlotLine('cumulative-result');
                        combinedChart.xAxis[0].removePlotLine('between-lower');
                        combinedChart.xAxis[0].removePlotLine('between-upper');
                        combinedChart.xAxis[0].removePlotLine('between-result');

                        const precision = parseInt(document.getElementById('precision')?.value) || 4;

                        if (calcType === 'cumulative') {
                            const kValueCum = parseInt(document.getElementById('kValue')?.value) || 5;
                            if (kValueCum >= minK && kValueCum <= maxK) {
                                const cumulativeResult = binomialCDF(kValueCum, n, p);

                                combinedChart.xAxis[0].addPlotLine({
                                    id: 'cumulative-result',
                                    value: kValueCum,
                                    color: '#e74c3c',
                                    width: 3,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `P(X ≤ ${kValueCum}) = ${cumulativeResult.toFixed(precision)}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold',
                                            background: 'rgba(231, 76, 60, 0.8)',
                                            padding: '4px 8px',
                                            borderRadius: '4px'
                                        },
                                        align: 'center',
                                        y: -10
                                    }
                                });
                            }
                        } else if (calcType === 'probability') {
                            const kValue = parseInt(document.getElementById('kValue')?.value) || 5;
                            if (kValue >= minK && kValue <= maxK) {
                                const probabilityResult = binomialPMF(kValue, n, p);

                                combinedChart.xAxis[0].addPlotLine({
                                    id: 'cumulative-result',
                                    value: kValue,
                                    color: '#9b59b6',
                                    width: 3,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `P(X = ${kValue}) = ${probabilityResult.toFixed(precision)}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold',
                                            background: 'rgba(155, 89, 182, 0.8)',
                                            padding: '4px 8px',
                                            borderRadius: '4px'
                                        },
                                        align: 'center',
                                        y: -10
                                    }
                                });
                            }
                        } else if (calcType === 'between') {
                            const lowerBound = parseInt(document.getElementById('lowerBound')?.value) || 3;
                            const upperBound = parseInt(document.getElementById('upperBound')?.value) || 7;

                            if (lowerBound >= minK && upperBound <= maxK && lowerBound <= upperBound) {
                                const lowerProb = lowerBound > 0 ? binomialCDF(lowerBound - 1, n, p) : 0;
                                const upperProb = binomialCDF(upperBound, n, p);
                                const betweenResult = upperProb - lowerProb;

                                // Lower bound line
                                combinedChart.xAxis[0].addPlotLine({
                                    id: 'between-lower',
                                    value: lowerBound,
                                    color: '#27ae60',
                                    width: 2,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `${lowerBound}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold'
                                        },
                                        align: 'center',
                                        y: 20
                                    }
                                });

                                // Upper bound line
                                combinedChart.xAxis[0].addPlotLine({
                                    id: 'between-upper',
                                    value: upperBound,
                                    color: '#27ae60',
                                    width: 2,
                                    dashStyle: 'Dash',
                                    label: {
                                        text: `${upperBound}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold'
                                        },
                                        align: 'center',
                                        y: 20
                                    }
                                });

                                // Result label at midpoint
                                const midpoint = (lowerBound + upperBound) / 2;
                                combinedChart.xAxis[0].addPlotLine({
                                    id: 'between-result',
                                    value: midpoint,
                                    color: 'transparent',
                                    width: 0,
                                    label: {
                                        text: `P(${lowerBound} ≤ X ≤ ${upperBound}) = ${betweenResult.toFixed(precision)}`,
                                        style: {
                                            color: 'white',
                                            fontWeight: 'bold',
                                            background: 'rgba(39, 174, 96, 0.8)',
                                            padding: '4px 8px',
                                            borderRadius: '4px'
                                        },
                                        align: 'center',
                                        y: -10
                                    }
                                });
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Error updating Combined chart plot lines:', error);
                }

                try {
                    combinedChart.redraw();
                } catch (error) {
                    console.warn('Error redrawing Combined chart:', error);
                }
            }

            // Add visual indicators to chart container
            updateChartIndicators(highlightValues, calcType);
        }

        function updateChartIndicators(highlightValues, calcType) {
            // Disabled - indicators removed
            return;
            
            // Remove existing indicators
            document.querySelectorAll('.chart-indicator').forEach(el => el.remove());

            // Create visual indicators below charts
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                const indicator = document.createElement('div');
                indicator.className = 'chart-indicator';
                indicator.style.cssText = `
                    margin-top: 15px;
                    padding: 15px;
                    background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(20,20,30,0.4) 100%);
                    border-radius: 8px;
                    display: flex;
                    gap: 20px;
                    flex-wrap: wrap;
                    justify-content: center;
                    align-items: center;
                    font-size: 14px;
                    border: 1px solid white;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                `;

                // Add k value markers
                if (highlightValues.length > 0 && highlightValues.length <= 5) {
                    highlightValues.forEach((k, index) => {
                        const markerEl = document.createElement('div');
                        markerEl.className = 'x-marker';
                        const color = 'rgb(255,165,120)';
                        markerEl.style.cssText = `
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            padding: 8px 15px;
                            background: linear-gradient(135deg, ${color}30 0%, ${color}20 100%);
                            border: 2px solid ${color};
                            border-radius: 6px;
                            color: white;
                            font-weight: bold;
                            box-shadow: 0 2px 8px ${color}40;
                            transition: all 0.3s ease;
                        `;

                        // Add vertical line indicator
                        const lineEl = document.createElement('div');
                        lineEl.style.cssText = `
                            width: 4px;
                            height: 20px;
                            background: linear-gradient(to bottom, ${color} 0%, ${color}80 100%);
                            border-radius: 2px;
                            box-shadow: 0 0 4px ${color}60;
                        `;

                        // Add label
                        const labelEl = document.createElement('span');
                        labelEl.textContent = `k = ${k}`;
                        labelEl.style.fontSize = '13px';

                        markerEl.appendChild(lineEl);
                        markerEl.appendChild(labelEl);

                        // Add hover effect
                        markerEl.addEventListener('mouseenter', function() {
                            this.style.transform = 'translateY(-2px)';
                            this.style.boxShadow = `0 4px 16px ${color}60`;
                        });

                        markerEl.addEventListener('mouseleave', function() {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = `0 2px 8px ${color}40`;
                        });

                        indicator.appendChild(markerEl);
                    });
                } else if (highlightValues.length > 5) {
                    // Show range instead of individual values
                    const rangeEl = document.createElement('div');
                    rangeEl.className = 'x-marker';
                    const color = 'rgb(255,165,120)';
                    rangeEl.style.cssText = `
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        padding: 8px 15px;
                        background: linear-gradient(135deg, ${color}30 0%, ${color}20 100%);
                        border: 2px solid ${color};
                        border-radius: 6px;
                        color: white;
                        font-weight: bold;
                        box-shadow: 0 2px 8px ${color}40;
                        transition: all 0.3s ease;
                    `;

                    const lineEl = document.createElement('div');
                    lineEl.style.cssText = `
                        width: 4px;
                        height: 20px;
                        background: linear-gradient(to bottom, ${color} 0%, ${color}80 100%);
                        border-radius: 2px;
                        box-shadow: 0 0 4px ${color}60;
                    `;

                    const labelEl = document.createElement('span');
                    labelEl.textContent = `k = ${Math.min(...highlightValues)} to ${Math.max(...highlightValues)}`;
                    labelEl.style.fontSize = '13px';

                    rangeEl.appendChild(lineEl);
                    rangeEl.appendChild(labelEl);

                    indicator.appendChild(rangeEl);
                }

                // Add separator if we have markers and result
                if (highlightValues.length > 0) {
                    const separator = document.createElement('div');
                    separator.style.cssText = `
                        width: 2px;
                        height: 30px;
                        background: linear-gradient(to bottom, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
                        border-radius: 1px;
                    `;
                    indicator.appendChild(separator);
                }

                // Add calculation result
                const resultEl = document.createElement('div');
                resultEl.className = 'probability-result';
                resultEl.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 5px;
                    padding: 12px 20px;
                    background: linear-gradient(135deg, rgba(168, 192, 231, 0.25) 0%, rgba(148, 172, 211, 0.15) 100%);
                    border: 2px solid rgba(168, 192, 231, 0.7);
                    border-radius: 8px;
                    color: rgb(255,165,120);
                    font-weight: bold;
                    text-align: center;
                    min-width: 140px;
                    box-shadow: 0 4px 12px rgba(168, 192, 231, 0.3);
                `;

                const mainResult = document.getElementById('mainResult').textContent;
                if (!isNaN(parseFloat(mainResult))) {
                    const percentage = parseFloat(mainResult) * 100;

                    const probabilityLabel = document.createElement('div');
                    probabilityLabel.textContent = 'Probability';
                    probabilityLabel.style.cssText = 'font-size: 11px; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px;';

                    const probabilityValue = document.createElement('div');
                    probabilityValue.textContent = `${percentage.toFixed(2)}%`;
                    probabilityValue.style.cssText = 'font-size: 16px; font-weight: bold;';

                    const decimalValue = document.createElement('div');
                    decimalValue.textContent = `(${parseFloat(mainResult).toFixed(4)})`;
                    decimalValue.style.cssText = 'font-size: 10px; opacity: 0.7;';

                    resultEl.appendChild(probabilityLabel);
                    resultEl.appendChild(probabilityValue);
                    resultEl.appendChild(decimalValue);
                } else {
                    resultEl.textContent = mainResult;
                }

                indicator.appendChild(resultEl);

                container.appendChild(indicator);
            });
        }

        function switchTab(tabName, clickedElement) {
            // Get the clicked element - either from parameter or event
            const tabElement = clickedElement || event?.target || document.querySelector(`.tab[onclick*="${tabName}"]`);

            if (!tabElement) {
                console.error('Tab element not found for:', tabName);
                return;
            }

            // Add switching animation to the clicked tab
            tabElement.classList.add('switching');
            setTimeout(() => {
                tabElement.classList.remove('switching');
            }, 800);

            // Hide all tab contents with fade out
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content with delay for smooth transition
            setTimeout(() => {
                document.getElementById(tabName + 'Tab').classList.add('active');

                // Add active class to selected tab
                tabElement.classList.add('active');

                // Trigger chart animations when switching tabs (but not on initial load)
                if (!isInitialLoad) {
                    setTimeout(() => {
                        triggerChartAnimations(tabName);
                    }, 300); // Delay to ensure tab content is visible
                }
            }, 100);
        }

        function triggerChartAnimations(tabName) {
            // Force chart animations by temporarily hiding and showing series
            switch(tabName) {
                case 'pmf':
                    if (pmfChart) {
                        animateChartSeries(pmfChart, 'pmf');
                        animateChartIndicators();
                    }
                    break;
                case 'cdf':
                    if (cdfChart) {
                        animateChartSeries(cdfChart, 'cdf');
                        animateChartIndicators();
                    }
                    break;
                case 'both':
                    if (combinedChart) {
                        animateChartSeries(combinedChart, 'combined');
                        animateChartIndicators();
                    }
                    break;
            }
        }

        function animateChartIndicators() {
            // Add glow effect to chart indicators
            const indicators = document.querySelectorAll('.chart-indicator');
            indicators.forEach((indicator, index) => {
                setTimeout(() => {
                    indicator.style.transform = 'scale(1.05)';
                    indicator.style.boxShadow = '0 8px 32px rgba(52, 152, 219, 0.4)';
                    indicator.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';

                    setTimeout(() => {
                        indicator.style.transform = 'scale(1)';
                        indicator.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                    }, 600);
                }, index * 100);
            });
        }

        function animateChartSeries(chart, chartType) {
            try {
                if (!chart || !chart.series || !chart.container) {
                    console.warn('Chart not properly initialized for animation');
                    return;
                }

                // For discrete distributions, use a simpler fade animation
                const chartContainer = chart.container.parentElement;
                if (chartContainer) {
                    chartContainer.style.opacity = '0.3';
                    chartContainer.style.transition = 'opacity 0.6s ease';

                    setTimeout(() => {
                        chartContainer.style.opacity = '1';
                    }, 200);
                }

            } catch (error) {
                console.warn('Error in animateChartSeries:', error);
            }
        }

        function reloadCalculator() {
            // Add visual feedback to all statistics boxes
            document.querySelectorAll('.embedded-stat-item').forEach(item => {
                item.classList.add('resetting');
                setTimeout(() => item.classList.remove('resetting'), 800);
            });

            // Show loading state
            const mainResultEl = document.getElementById('mainResult');
            if (mainResultEl) {
                mainResultEl.classList.add('calculating');
                mainResultEl.textContent = 'Resetting...';
            }

            // Reset all input values to defaults with animation
            const inputs = [
                { el: document.getElementById('nTrials'), value: '10' },
                { el: document.getElementById('pSuccess'), value: '0.5' },
                { el: document.getElementById('kValue'), value: '5' },
                { el: document.getElementById('precision'), value: '4' },
                { el: document.getElementById('chartRange'), value: 'centered' }
            ];

            inputs.forEach(({ el, value }, index) => {
                if (el) {
                    setTimeout(() => {
                        el.style.transition = 'all 0.3s ease';
                        el.style.transform = 'scale(1.05)';
                        el.value = value;

                        setTimeout(() => {
                            el.style.transform = 'scale(1)';
                        }, 150);
                    }, index * 100);
                }
            });

            // Reset radio button to default (probability)
            const probabilityRadio = document.querySelector('input[value="probability"]');
            if (probabilityRadio) {
                probabilityRadio.checked = true;
                currentCalcType = 'probability';
            }

            // Reset chart options dropdowns
            const precisionDropdown = document.getElementById('precision');
            const chartRangeDropdown = document.getElementById('chartRange');
            if (precisionDropdown) precisionDropdown.value = '4';
            if (chartRangeDropdown) chartRangeDropdown.value = 'centered';

            // Reset tab to PMF view with animation
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            setTimeout(() => {
                const pmfTab = document.querySelector('.tab');
                const pmfTabContent = document.getElementById('pmfTab');
                if (pmfTab) pmfTab.classList.add('active');
                if (pmfTabContent) pmfTabContent.classList.add('active');
            }, 200);

            // Clear any dynamic input sections and recreate default
            updateInputSection();
            updateRadioSelection();

            // Animate reset with delay for better UX
            setTimeout(() => {
                if (mainResultEl) {
                    mainResultEl.classList.remove('calculating');
                }

                // Recalculate with default values
                updateStatistics();
                calculate();

                // Show success message briefly
                if (mainResultEl) {
                    const originalText = mainResultEl.textContent;
                    mainResultEl.textContent = '✓ Reset Complete!';
                    mainResultEl.style.color = '#27ae60';
                    mainResultEl.style.fontWeight = 'bold';

                    setTimeout(() => {
                        mainResultEl.style.color = '';
                        mainResultEl.style.fontWeight = '';
                        mainResultEl.textContent = originalText;
                    }, 1500);
                }

                // Add celebration effect
                createCelebrationEffect();

            }, 1000);
        }

        function createCelebrationEffect() {
            // Create a subtle celebration effect
            const header = document.querySelector('.header');
            if (header) {
                header.style.transform = 'scale(1.02)';
                header.style.transition = 'transform 0.3s ease';

                setTimeout(() => {
                    header.style.transform = 'scale(1)';
                }, 300);
            }
        }


/* ------------------------------
   RESULT ACTIONS
   - Web mode: copy works, Excel insertion is a placeholder
   - Office add-in mode: replace insertResultToExcel() with Office.js
-------------------------------- */
function copyMainResult() {
    const el = document.getElementById('mainResult');
    if (!el) return;
    const text = (el.textContent || '').trim();
    if (!text) return;

    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text);
    } else {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
    }
}

function insertResultToExcel() {
    // Placeholder: implement with Office.js in the add-in host.
    alert('Insert into Excel: implement via Office.js in add-in mode.');
}

function toggleAboutSection() {
    const aboutSection = document.getElementById('aboutSection');
    if (aboutSection) {
        if (aboutSection.style.display === 'none' || aboutSection.style.display === '') {
            // Show modal
            aboutSection.style.display = 'block';
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            // Scroll modal to top
            setTimeout(() => {
                aboutSection.scrollTop = 0;
            }, 10);
        } else {
            // Hide modal
            aboutSection.style.display = 'none';
            // Restore body scroll
            document.body.style.overflow = 'auto';
        }
    }
}

// Close modal when clicking on backdrop
document.addEventListener('DOMContentLoaded', function() {
    const aboutSection = document.getElementById('aboutSection');
    if (aboutSection) {
        aboutSection.addEventListener('click', function(e) {
            // Close only if clicking on the backdrop (not the content)
            if (e.target === aboutSection) {
                toggleAboutSection();
            }
        });
    }
});

</script>
</body>
</html>




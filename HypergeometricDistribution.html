<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: sans-serif;
        }
        #main-wrapper {
            width: 75vw;
            max-width: 1000px;
            margin: 0 auto;
            height: 95vh;
            overflow-y: auto;
            box-sizing: border-box;
            padding: 1rem;
        }
    </style>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        .main-container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
    </style>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>
        Hypergeometric Distribution Calculator
    </title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/annotations.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.6/dist/jstat.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/>
    <style>
        :root {
            --panel-bg: #484b57;
            --panel-radius: 10px;
            --panel-shadow: 0px 4px 20px rgba(0, 0, 0, 0.4);
            --header-bg: #000;
            --header-color: rgb(244,67,54);
            --highlight-bg: rgba(244, 67, 54, 0.2);
            --highlight-text: rgb(244, 67, 54);
            --primary-blue: #3498db;
            --primary-blue-hover: #2980b9;
            --success-green: #27ae60;
            --warning-orange: #f39c12;
            --danger-red: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #282c39 0%, #1e2329 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Panel Animation Support */
        .left-panel, .right-panel, [class*="panel"] {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--header-bg) 0%, #1a1a2e 100%);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--header-color);
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(244, 67, 54, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            color: #bdc3c7;
            line-height: 1.6;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .controls-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            padding: 25px;
            box-shadow: var(--panel-shadow);
            height: fit-content;
        }

        .controls-panel h3 {
            color: var(--header-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--header-color);
            padding-bottom: 8px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #ecf0f1;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #34495e;
            border-radius: 8px;
            background: #2c3e50;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--header-color);
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
        }

        .calculation-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 15px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        .tab-button.active {
            background: var(--header-color);
            color: white;
            font-weight: bold;
        }

        .tab-button:hover:not(.active) {
            background: #4a5f7a;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }



        .reset-button {
            width: 100%;
            padding: 10px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .reset-button:hover {
            background: #4a5f7a;
        }

        .info-button {
            width: 100%;
            padding: 10px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .info-button:hover {
            background: var(--header-color);
            color: white;
        }

        .chart-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            padding: 25px;
            box-shadow: var(--panel-shadow);
        }

        .chart-container {
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
        }

        .result-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            padding: 25px;
            box-shadow: var(--panel-shadow);
            margin-top: 20px;
        }

        .result-panel h3 {
            color: var(--header-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--header-color);
            margin: 10px 0;
            text-align: center;
            padding: 15px;
            background: var(--highlight-bg);
            border-radius: 8px;
            border: 2px solid rgba(244, 67, 54, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: #34495e;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--header-color);
        }

        .info-panel {
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            padding: 25px;
            box-shadow: var(--panel-shadow);
            margin-top: 20px;
        }

        .info-panel h3 {
            color: var(--header-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .info-panel p {
            color: #bdc3c7;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .info-panel .formula {
            background: #2c3e50;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            border-left: 4px solid var(--header-color);
        }

        .keyboard-shortcuts {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .shortcut {
            background: #34495e;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #bdc3c7;
        }

        .shortcut kbd {
            background: #2c3e50;
            padding: 2px 6px;
            border-radius: 3px;
            color: var(--header-color);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .calculation-tabs {
                flex-direction: column;
            }
            
            .tab-button {
                min-width: unset;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .error {
            color: var(--danger-red);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .success {
            color: var(--success-green);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 0.6s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Popup Modal Styles */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            animation: fadeInOverlay 0.3s ease;
        }

        .popup-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-bg);
            border-radius: var(--panel-radius);
            box-shadow: var(--panel-shadow);
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1001;
            animation: slideInModal 0.4s ease;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--header-color);
            padding-bottom: 10px;
        }

        .popup-title {
            color: var(--header-color);
            font-size: 1.4rem;
            margin: 0;
        }

        .popup-close {
            background: none;
            border: none;
            color: #bdc3c7;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: var(--header-color);
            color: white;
        }

        .popup-content {
            color: #bdc3c7;
            line-height: 1.6;
        }

        .popup-content p {
            margin-bottom: 15px;
        }

        .popup-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .popup-content li {
            margin-bottom: 5px;
        }

        .popup-formula {
            background: #2c3e50;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 4px solid var(--header-color);
        }

        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }

                 @keyframes slideInModal {
             from { 
                 opacity: 0;
                 transform: translate(-50%, -60%);
                 scale: 0.9;
             }
             to { 
                 opacity: 1;
                 transform: translate(-50%, -50%);
                 scale: 1;
             }
         }

         /* Combined Tabs and Options Row */
        .tabs-and-options-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }

        .tabs {
            display: flex;
            margin-bottom: 0;
            border-bottom: none;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #bbb;
            position: relative;
            overflow: hidden;
        }

        .tab:hover {
            color: white;
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .tab.active {
            color: var(--header-color);
            border-bottom-color: var(--header-color);
            background: rgba(244, 67, 54, 0.1);
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .tab.switching {
            animation: tabSwitchPulse 0.8s ease;
        }

        @keyframes tabSwitchPulse {
            0% {
                transform: translateY(0);
                box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
            }
            50% {
                transform: translateY(-4px);
                box-shadow: 0 8px 24px rgba(244, 67, 54, 0.5);
            }
            100% {
                transform: translateY(0);
                box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
            }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Chart Options Toolbar Styles */
        .chart-options-toolbar {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .chart-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: #bbb;
            font-weight: 500;
            white-space: nowrap;
        }

        .option-label i {
            font-size: 0.8rem;
            color: var(--header-color);
            opacity: 0.8;
        }

        .mini-dropdown {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            font-size: 0.8rem;
            min-width: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mini-dropdown:hover {
            background: rgba(255,255,255,0.12);
            border-color: var(--header-color);
        }

        .mini-dropdown:focus {
            outline: none;
            border-color: var(--header-color);
            background: rgba(244, 67, 54, 0.1);
            box-shadow: 0 0 8px rgba(244, 67, 54, 0.3);
        }

        .mini-dropdown option {
            background: #2c3e50;
            color: white;
            padding: 4px;
        }

        /* Results Row Layout */
        .results-row {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            align-items: stretch;
        }

        .results-row .probability-visualization {
            flex: 0 0 40%;
            margin-top: 0;
        }

        .results-row .embedded-results-panel {
            flex: 1;
            margin-top: 0;
        }

        .probability-visualization {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
        }

        /* Chart Animation Styles */
        #pdfChart, #cdfChart, #combinedChart {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
        }

        #pdfChart:hover, #cdfChart:hover, #combinedChart:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .shaded-area-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 10px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 6px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .shaded-area-info.updating {
            background: rgba(52, 152, 219, 0.15);
            border: 1px solid rgba(52, 152, 219, 0.3);
            transform: scale(1.02);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.2);
        }

        /* Embedded Results Panel Styles */
        .embedded-results-panel {
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .panel-title {
            font-size: 1.4rem;
            color: var(--header-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .embedded-panel-title {
            font-size: 0.85rem;
            color: var(--header-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .embedded-stats-grid {
            display: flex;
            gap: 4px;
            flex-wrap: nowrap;
            justify-content: center;
            overflow-x: auto;
        }

        .embedded-stat-item {
            background: rgba(255,255,255,0.08);
            padding: 4px 6px;
            border-radius: 4px;
            text-align: center;
            min-width: 55px;
            flex: 0 0 auto;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }

        .embedded-stat-item.updating {
            transform: scale(1.05) translateY(-2px);
            background: rgba(52, 152, 219, 0.2);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.3);
        }

        .embedded-stat-item:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .embedded-stat-item.primary-result {
            background: rgba(244, 67, 54, 0.15);
            border: 1px solid rgba(244, 67, 54, 0.3);
            min-width: 65px;
        }

        .embedded-stat-item.primary-result:hover {
            background: rgba(244, 67, 54, 0.25);
            box-shadow: 0 4px 16px rgba(244, 67, 54, 0.3);
        }

        .embedded-stat-value {
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--header-color);
            line-height: 1.1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .embedded-stat-value.animating {
            color: #3498db;
            transform: scale(1.1);
            text-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
        }

        .embedded-stat-item.primary-result .embedded-stat-value {
            color: var(--header-color);
        }

        .embedded-stat-label {
            color: #bbb;
            font-size: 0.5rem;
            margin-top: 1px;
            line-height: 1;
            transition: color 0.3s ease;
        }

        @media (max-width: 768px) {
            .tabs-and-options-row {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .chart-options-toolbar {
                justify-content: center;
                gap: 15px;
                flex-wrap: wrap;
            }

            .option-label {
                font-size: 0.8rem;
            }

            .mini-dropdown {
                font-size: 0.75rem;
                min-width: 45px;
            }

            .results-row {
                flex-direction: column;
                gap: 15px;
            }

            .results-row .probability-visualization {
                flex: none;
            }

            .results-row .embedded-results-panel {
                flex: none;
            }

            .embedded-stats-grid {
                gap: 3px;
                justify-content: flex-start;
            }

            .embedded-stat-item {
                min-width: 45px;
                padding: 3px 4px;
            }

            .embedded-stat-value {
                font-size: 0.6rem;
            }

            .embedded-stat-label {
                font-size: 0.45rem;
            }
        }

        /* Input Interaction Animations */
        input[type="number"] {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        input[type="number"]:focus {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.4);
            border-color: var(--header-color);
        }

        input[type="number"]:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .mini-dropdown {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mini-dropdown:focus, .mini-dropdown:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(231, 76, 60, 0.3);
        }

        /* Calculation Button Animations */
        .calculation-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .calculation-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }

        .calculation-button.active {
            animation: pulseActive 2s ease-in-out infinite;
        }

        @keyframes pulseActive {
            0%, 100% {
                box-shadow: 0 0 15px rgba(231, 76, 60, 0.4);
            }
            50% {
                box-shadow: 0 0 25px rgba(231, 76, 60, 0.6);
            }
        }

        /* Custom Tooltip Styles */
         .tooltip {
             position: relative;
             cursor: help;
         }

         .tooltip::before {
             content: attr(data-tooltip);
             position: absolute;
             bottom: 125%;
             left: 50%;
             transform: translateX(-50%);
             background: rgba(0, 0, 0, 0.9);
             color: white;
             padding: 8px 12px;
             border-radius: 6px;
             font-size: 0.85rem;
             font-weight: normal;
             white-space: nowrap;
             opacity: 0;
             visibility: hidden;
             transition: all 0.3s ease;
             z-index: 1000;
             pointer-events: none;
             box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
         }

         .tooltip::after {
             content: '';
             position: absolute;
             bottom: 117%;
             left: 50%;
             transform: translateX(-50%);
             border: 5px solid transparent;
             border-top-color: rgba(0, 0, 0, 0.9);
             opacity: 0;
             visibility: hidden;
             transition: all 0.3s ease;
             z-index: 1000;
             pointer-events: none;
         }

         .tooltip:hover::before,
         .tooltip:hover::after {
             opacity: 1;
             visibility: visible;
         }

         /* Adjust tooltip position for inputs that might be near screen edges */
         .tooltip.tooltip-left::before {
             left: 0;
             transform: translateX(0);
         }

         .tooltip.tooltip-left::after {
             left: 20px;
             transform: translateX(0);
         }

         .tooltip.tooltip-right::before {
             right: 0;
             left: auto;
             transform: translateX(0);
         }

         .tooltip.tooltip-right::after {
             right: 20px;
             left: auto;
             transform: translateX(0);
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-bar"></i> Hypergeometric Distribution Calculator</h1>
            <p>Calculate probabilities for sampling without replacement from a finite population</p>
        </div>

        <div class="main-content">
            <div class="controls-panel">
                <h3><i class="fas fa-sliders-h"></i> Parameters</h3>
                <div class="input-group">
                    <label for="N-input" class="tooltip" data-tooltip="Total number of items in the population">Population Size (N):</label>
                    <input type="number" id="N-input" min="1" step="1" value="50" placeholder="Total population size">
                    <div class="error" id="N-error"></div>
                </div>
                <div class="input-group">
                    <label for="K-input" class="tooltip" data-tooltip="Number of items in the population that are classified as successes">Success States (K):</label>
                    <input type="number" id="K-input" min="0" step="1" value="20" placeholder="Number of success states in population">
                    <div class="error" id="K-error"></div>
                </div>
                <div class="input-group">
                    <label for="n-input" class="tooltip" data-tooltip="Number of items drawn from the population without replacement">Sample Size (n):</label>
                    <input type="number" id="n-input" min="1" step="1" value="10" placeholder="Number of draws">
                    <div class="error" id="n-error"></div>
                </div>

                <h3><i class="fas fa-calculator"></i> Calculation Type</h3>
                <div class="calculation-tabs">
                    <button class="tab-button active" data-tab="probability">P(X = k)</button>
                    <button class="tab-button" data-tab="cumulative">P(X ≤ k)</button>
                    <button class="tab-button" data-tab="between">P(a ≤ X ≤ b)</button>
                </div>

                <div class="tab-content active" id="probability">
                    <div class="input-group">
                        <label for="k-input" class="tooltip" data-tooltip="Exact number of successes to calculate probability for">Number of successes (k):</label>
                        <input type="number" id="k-input" min="0" step="1" value="5" placeholder="Number of successes drawn">
                        <div class="error" id="k-error"></div>
                    </div>
                </div>

                <div class="tab-content" id="cumulative">
                    <div class="input-group">
                        <label for="k-cum-input" class="tooltip" data-tooltip="Maximum number of successes for cumulative probability">Number of successes (k):</label>
                        <input type="number" id="k-cum-input" min="0" step="1" value="8" placeholder="Number of successes drawn">
                        <div class="error" id="k-cum-error"></div>
                    </div>
                </div>

                <div class="tab-content" id="between">
                    <div class="input-group">
                        <label for="a-input" class="tooltip" data-tooltip="Minimum number of successes in the range">Lower bound (a):</label>
                        <input type="number" id="a-input" min="0" step="1" value="3" placeholder="Lower bound">
                        <div class="error" id="a-error"></div>
                    </div>
                    <div class="input-group">
                        <label for="b-input" class="tooltip" data-tooltip="Maximum number of successes in the range">Upper bound (b):</label>
                        <input type="number" id="b-input" min="0" step="1" value="7" placeholder="Upper bound">
                        <div class="error" id="b-error"></div>
                    </div>
                </div>

                <div style="text-align: center; padding: 10px; background: rgba(244, 67, 54, 0.1); border-radius: 6px; border: 0px solid rgba(244, 67, 54, 0.3); margin-top: 15px;">
                    <i class="fas fa-bolt" style="color: var(--header-color); margin-right: 8px;"></i>
                    <span style="color: var(--header-color); font-weight: 600; font-size: 0.9rem;">Results update instantly as you type!</span>
                </div>

                <button class="reset-button" onclick="resetAll()">
                    <i class="fas fa-redo"></i> Reset
                </button>

                <button class="info-button" onclick="showInfoPopup()">
                    <i class="fas fa-info-circle"></i> About Distribution
                </button>
            </div>

            <div class="visualization-panel">
                <h3 class="panel-title">
                    <i class="fas fa-chart-area"></i>
                    Results Panel - Visualizations & Statistics
                </h3>
                <!-- Combined Tabs and Chart Options Row -->
                <div class="tabs-and-options-row">
                    <!-- Tabs on the Left -->
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab('pdf', this)">
                            PMF View
                        </div>
                        <div class="tab" onclick="switchTab('cdf', this)">
                            CDF View
                        </div>
                        <div class="tab" onclick="switchTab('both', this)">
                            Combined View
                        </div>
                    </div>
                    
                    <!-- Chart Options on the Right -->
                    <div class="chart-options-toolbar">
                        <div class="chart-option">
                            <label for="precision" class="option-label">
                                <i class="fas fa-decimal"></i>
                                Precision
                            </label>
                            <select class="mini-dropdown" id="precision">
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option selected value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="chart-option">
                            <label for="chartRange" class="option-label">
                                <i class="fas fa-expand-arrows-alt"></i>
                                Range
                            </label>
                            <select class="mini-dropdown" id="chartRange">
                                <option value="1">1x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2x</option>
                                <option value="2.5">2.5x</option>
                                <option selected value="3">3x</option>
                                <option value="3.5">3.5x</option>
                                <option value="4">4x</option>
                                <option value="4.5">4.5x</option>
                                <option value="5">5x</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="tab-content active" id="pdfTab">
                    <div class="chart-container">
                        <div id="pdfChart"></div>
                    </div>
                </div>
                <div class="tab-content" id="cdfTab">
                    <div class="chart-container">
                        <div id="cdfChart"></div>
                    </div>
                </div>
                <div class="tab-content" id="bothTab">
                    <div class="chart-container">
                        <div id="combinedChart"></div>
                    </div>
                </div>
                <!-- Combined Results Row - Shaded Area + Statistics -->
                <div class="results-row">
                    <div class="probability-visualization">
                        <h4 style="color: var(--header-color); margin-bottom: 10px;">
                            <i class="fas fa-area-chart"></i>
                            Shaded Area Representation
                        </h4>
                        <div class="shaded-area-info">
                            <span id="areaDescription">Select calculation type to see shaded area</span>
                            <span id="areaValue" style="font-weight: bold; color: var(--header-color);">--</span>
                        </div>
                    </div>
                    
                    <!-- Embedded Results & Statistics Panel -->
                    <div class="embedded-results-panel">
                        <h4 class="embedded-panel-title">
                            <i class="fas fa-chart-bar"></i>
                            Results & Statistics
                        </h4>
                        <div class="embedded-stats-grid">
                            <div class="embedded-stat-item primary-result">
                                <div class="embedded-stat-value" id="mainResult">--</div>
                                <div class="embedded-stat-label">Result</div>
                            </div>
                            <div class="embedded-stat-item">
                                <div class="embedded-stat-value" id="stat-N">50</div>
                                <div class="embedded-stat-label">Pop (N)</div>
                            </div>
                            <div class="embedded-stat-item">
                                <div class="embedded-stat-value" id="stat-K">20</div>
                                <div class="embedded-stat-label">Success (K)</div>
                            </div>
                            <div class="embedded-stat-item">
                                <div class="embedded-stat-value" id="stat-n">10</div>
                                <div class="embedded-stat-label">Sample (n)</div>
                            </div>
                            <div class="embedded-stat-item">
                                <div class="embedded-stat-value" id="stat-mean">4</div>
                                <div class="embedded-stat-label">Mean</div>
                            </div>
                            <div class="embedded-stat-item">
                                <div class="embedded-stat-value" id="stat-variance">1.6</div>
                                <div class="embedded-stat-label">Variance</div>
                            </div>
                            <div class="embedded-stat-item">
                                <div class="embedded-stat-value" id="stat-stddev">1.26</div>
                                <div class="embedded-stat-label">Std Dev</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <script>
        let currentChart = null;
        let isAnimating = false;
        let currentCalculationType = 'probability';

        // Animated number transition
        function animateNumber(element, start, end, duration = 800) {
            const startTime = performance.now();
            const isInteger = Number.isInteger(end);
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = start + (end - start) * easeOut;
                
                if (isInteger) {
                    element.textContent = Math.round(current).toFixed(0);
                } else {
                    element.textContent = current.toFixed(6);
                }
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
                currentCalculationType = button.dataset.tab;
                
                updateChart();
                updateResultDisplays();
                calculateResult();
            });
        });

        // Input validation
        function validateInputs() {
            const N = parseInt(document.getElementById('N-input').value);
            const K = parseInt(document.getElementById('K-input').value);
            const n = parseInt(document.getElementById('n-input').value);
            let isValid = true;

            // Clear previous errors
            document.querySelectorAll('.error').forEach(el => el.textContent = '');

            if (isNaN(N) || N < 1) {
                document.getElementById('N-error').textContent = 'Population size must be a positive integer';
                isValid = false;
            }

            if (isNaN(K) || K < 0) {
                document.getElementById('K-error').textContent = 'Success states must be a non-negative integer';
                isValid = false;
            }

            if (isNaN(n) || n < 1) {
                document.getElementById('n-error').textContent = 'Sample size must be a positive integer';
                isValid = false;
            }

            if (!isNaN(N) && !isNaN(K) && K > N) {
                document.getElementById('K-error').textContent = 'Success states cannot exceed population size';
                isValid = false;
            }

            if (!isNaN(N) && !isNaN(n) && n > N) {
                document.getElementById('n-error').textContent = 'Sample size cannot exceed population size';
                isValid = false;
            }

            if (currentCalculationType === 'probability') {
                const k = parseInt(document.getElementById('k-input').value);
                if (isNaN(k) || k < 0) {
                    document.getElementById('k-error').textContent = 'Number of successes must be a non-negative integer';
                    isValid = false;
                }
                if (!isNaN(k) && !isNaN(n) && k > n) {
                    document.getElementById('k-error').textContent = 'Successes cannot exceed sample size';
                    isValid = false;
                }
                if (!isNaN(k) && !isNaN(K) && k > K) {
                    document.getElementById('k-error').textContent = 'Successes cannot exceed available success states';
                    isValid = false;
                }
            } else if (currentCalculationType === 'cumulative') {
                const k = parseInt(document.getElementById('k-cum-input').value);
                if (isNaN(k) || k < 0) {
                    document.getElementById('k-cum-error').textContent = 'Number of successes must be a non-negative integer';
                    isValid = false;
                }
            } else if (currentCalculationType === 'between') {
                const a = parseInt(document.getElementById('a-input').value);
                const b = parseInt(document.getElementById('b-input').value);
                if (isNaN(a) || a < 0) {
                    document.getElementById('a-error').textContent = 'Lower bound must be a non-negative integer';
                    isValid = false;
                }
                if (isNaN(b) || b < 0) {
                    document.getElementById('b-error').textContent = 'Upper bound must be a non-negative integer';
                    isValid = false;
                }
                if (!isNaN(a) && !isNaN(b) && a > b) {
                    document.getElementById('b-error').textContent = 'Upper bound must be greater than or equal to lower bound';
                    isValid = false;
                }
            }

            return isValid;
        }

        // Calculate result with feedback animations
        function calculateResult() {
            if (!validateInputs()) return;

            const N = parseInt(document.getElementById('N-input').value);
            const K = parseInt(document.getElementById('K-input').value);
            const n = parseInt(document.getElementById('n-input').value);

            try {
                // Animate result elements
                const resultElement = document.getElementById('mainResult');
                const areaValueElement = document.getElementById('areaValue');
                
                if (resultElement) {
                    resultElement.classList.add('pulse');
                    setTimeout(() => resultElement.classList.remove('pulse'), 600);
                }
                
                if (areaValueElement) {
                    areaValueElement.classList.add('pulse');
                    setTimeout(() => areaValueElement.classList.remove('pulse'), 600);
                }

                updateChart();
                updateStatistics(N, K, n);
                updateResultDisplays();

            } catch (error) {
                const resultElement = document.getElementById('mainResult');
                const areaValueElement = document.getElementById('areaValue');
                if (resultElement) resultElement.textContent = 'Error';
                if (areaValueElement) areaValueElement.textContent = 'Error';
                console.error('Calculation error:', error);
            }
        }

        // Update statistics
        function updateStatistics(N, K, n) {
            const p = K / N;
            const mean = n * p;
            const variance = n * p * (1 - p) * (N - n) / (N - 1);
            const stddev = Math.sqrt(variance);

            animateNumber(document.getElementById('stat-N'), parseFloat(document.getElementById('stat-N').textContent) || 0, N);
            animateNumber(document.getElementById('stat-K'), parseFloat(document.getElementById('stat-K').textContent) || 0, K);
            animateNumber(document.getElementById('stat-n'), parseFloat(document.getElementById('stat-n').textContent) || 0, n);
            animateNumber(document.getElementById('stat-mean'), parseFloat(document.getElementById('stat-mean').textContent) || 0, mean);
            animateNumber(document.getElementById('stat-variance'), parseFloat(document.getElementById('stat-variance').textContent) || 0, variance);
            animateNumber(document.getElementById('stat-stddev'), parseFloat(document.getElementById('stat-stddev').textContent) || 0, stddev);
        }

        // Update all charts
        function updateChart() {
            const N = parseInt(document.getElementById('N-input').value);
            const K = parseInt(document.getElementById('K-input').value);
            const n = parseInt(document.getElementById('n-input').value);
            const precision = parseInt(document.getElementById('precision')?.value) || 4;
            const chartRange = parseFloat(document.getElementById('chartRange')?.value) || 3;
            
            if (isNaN(N) || isNaN(K) || isNaN(n) || N < 1 || K < 0 || n < 1 || K > N || n > N) return;

            // Generate data points for PMF and CDF
            const minK = Math.max(0, n - (N - K));
            const maxK = Math.min(n, K);
            const pmfData = [];
            const cdfData = [];
            const highlightData = [];

            for (let k = minK; k <= maxK; k++) {
                const pmf = jStat.hypgeom.pdf(k, N, K, n);
                const cdf = jStat.hypgeom.cdf(k, N, K, n);
                pmfData.push([k, pmf]);
                cdfData.push([k, cdf]);
            }

            // Determine highlighted areas based on current calculation type
            if (currentCalculationType === 'probability') {
                const targetK = parseInt(document.getElementById('k-input')?.value);
                if (!isNaN(targetK) && targetK >= minK && targetK <= maxK) {
                    highlightData.push([targetK, jStat.hypgeom.pdf(targetK, N, K, n)]);
                }
            } else if (currentCalculationType === 'cumulative') {
                const targetK = parseInt(document.getElementById('k-cum-input')?.value);
                if (!isNaN(targetK)) {
                    for (let k = minK; k <= Math.min(targetK, maxK); k++) {
                        highlightData.push([k, jStat.hypgeom.pdf(k, N, K, n)]);
                    }
                }
            } else if (currentCalculationType === 'between') {
                const a = parseInt(document.getElementById('a-input')?.value);
                const b = parseInt(document.getElementById('b-input')?.value);
                if (!isNaN(a) && !isNaN(b)) {
                    for (let k = Math.max(minK, a); k <= Math.min(maxK, b); k++) {
                        highlightData.push([k, jStat.hypgeom.pdf(k, N, K, n)]);
                    }
                }
            }

            // Update PMF Chart with animations
            if (pdfChart && pdfChart.series) {
                try {
                    // Add smooth animation for data updates
                    pdfChart.series[0].setData(pmfData, {
                        duration: 800,
                        easing: 'easeOutQuart'
                    });
                    if (pdfChart.series[1]) {
                        pdfChart.series[1].setData(highlightData, {
                            duration: 600,
                            easing: 'easeOutBack'
                        });
                    }
                    
                    // Add pulse effect to chart container
                    const chartContainer = document.getElementById('pdfChart');
                    if (chartContainer) {
                        chartContainer.style.transform = 'scale(1.02)';
                        setTimeout(() => {
                            chartContainer.style.transform = 'scale(1)';
                        }, 200);
                    }
                } catch (error) {
                    console.warn('Error updating PMF chart:', error);
                }
            }

            // Update CDF Chart with animations
            if (cdfChart && cdfChart.series) {
                try {
                    cdfChart.series[0].setData(cdfData, {
                        duration: 900,
                        easing: 'easeInOutQuart'
                    });
                    
                    // Add glow effect to CDF chart
                    const cdfContainer = document.getElementById('cdfChart');
                    if (cdfContainer) {
                        cdfContainer.style.boxShadow = '0 0 20px rgba(39, 174, 96, 0.4)';
                        setTimeout(() => {
                            cdfContainer.style.boxShadow = '';
                        }, 600);
                    }
                } catch (error) {
                    console.warn('Error updating CDF chart:', error);
                }
            }

            // Update Combined Chart with staggered animations
            if (combinedChart && combinedChart.series) {
                try {
                    // Animate PMF first
                    combinedChart.series[0].setData(pmfData, {
                        duration: 700,
                        easing: 'easeOutQuart'
                    });
                    
                    // Then animate CDF with delay
                    setTimeout(() => {
                        if (combinedChart.series[1]) {
                            combinedChart.series[1].setData(cdfData, {
                                duration: 800,
                                easing: 'easeOutBack'
                            });
                        }
                    }, 200);
                    
                    // Add combined glow effect
                    const combinedContainer = document.getElementById('combinedChart');
                    if (combinedContainer) {
                        combinedContainer.style.boxShadow = '0 0 25px rgba(231, 76, 60, 0.3)';
                        setTimeout(() => {
                            combinedContainer.style.boxShadow = '';
                        }, 1000);
                    }
                } catch (error) {
                    console.warn('Error updating Combined chart:', error);
                }
            }

            // Update area description and main result display
            updateResultDisplays();
        }

        function updateResultDisplays() {
            const areaDescEl = document.getElementById('areaDescription');
            const areaValueEl = document.getElementById('areaValue');
            const mainResultEl = document.getElementById('mainResult');

            // Calculate and display the current result
            if (!validateInputs()) return;

            const N = parseInt(document.getElementById('N-input').value);
            const K = parseInt(document.getElementById('K-input').value);
            const n = parseInt(document.getElementById('n-input').value);
            let result = 0;

            try {
                if (currentCalculationType === 'probability') {
                    const k = parseInt(document.getElementById('k-input')?.value);
                    if (areaDescEl) areaDescEl.textContent = `P(X = ${k})`;
                    result = jStat.hypgeom.pdf(k, N, K, n);
                } else if (currentCalculationType === 'cumulative') {
                    const k = parseInt(document.getElementById('k-cum-input')?.value);
                    if (areaDescEl) areaDescEl.textContent = `P(X ≤ ${k})`;
                    result = jStat.hypgeom.cdf(k, N, K, n);
                } else if (currentCalculationType === 'between') {
                    const a = parseInt(document.getElementById('a-input')?.value);
                    const b = parseInt(document.getElementById('b-input')?.value);
                    if (areaDescEl) areaDescEl.textContent = `P(${a} ≤ X ≤ ${b})`;
                    result = jStat.hypgeom.cdf(b, N, K, n) - jStat.hypgeom.cdf(a - 1, N, K, n);
                }

                // Update both area value and main result
                const precision = parseInt(document.getElementById('precision')?.value) || 4;
                const formattedResult = result.toFixed(precision);
                
                if (areaValueEl) areaValueEl.textContent = formattedResult;
                if (mainResultEl) mainResultEl.textContent = formattedResult;
                
            } catch (error) {
                if (areaValueEl) areaValueEl.textContent = 'Error';
                if (mainResultEl) mainResultEl.textContent = 'Error';
                console.error('Result display error:', error);
            }
        }

        // Reset function with dramatic animation
        function resetAll() {
            // Add dramatic reset animation
            const leftPanel = document.querySelector('.left-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            // Fade out effect
            if (leftPanel) {
                leftPanel.style.transform = 'scale(0.95)';
                leftPanel.style.opacity = '0.5';
            }
            if (rightPanel) {
                rightPanel.style.transform = 'scale(0.95)';
                rightPanel.style.opacity = '0.5';
            }
            
            setTimeout(() => {
                // Reset all values
                document.getElementById('N-input').value = '50';
                document.getElementById('K-input').value = '20';
                document.getElementById('n-input').value = '10';
                document.getElementById('k-input').value = '5';
                document.getElementById('k-cum-input').value = '8';
                document.getElementById('a-input').value = '3';
                document.getElementById('b-input').value = '7';
                document.getElementById('precision').value = '4';
                document.getElementById('chartRange').value = '3';
                
                // Clear errors
                document.querySelectorAll('.error').forEach(el => el.textContent = '');
                
                // Reset to first tab (PMF View)
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                const firstTab = document.querySelector('.tab');
                const firstTabContent = document.getElementById('pdfTab');
                if (firstTab) firstTab.classList.add('active');
                if (firstTabContent) firstTabContent.classList.add('active');
                
                currentCalculationType = 'probability';
                
                // Animate values back in
                if (leftPanel) {
                    leftPanel.style.transform = 'scale(1)';
                    leftPanel.style.opacity = '1';
                }
                if (rightPanel) {
                    rightPanel.style.transform = 'scale(1)';
                    rightPanel.style.opacity = '1';
                }
                
                // Update with animations
                setTimeout(() => {
                    updateChart();
                    updateStatistics(50, 20, 10);
                    calculateResult();
                    animateChartUpdate();
                }, 200);
            }, 300);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetAll();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                calculateResult();
            } else if (e.key === 'Escape') {
                document.querySelectorAll('input').forEach(input => input.blur());
            }
        });

        // Debounce function for smooth input handling
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Calculate with visual feedback
        function calculateWithFeedback() {
            // Add visual feedback to input fields
            const inputFields = document.querySelectorAll('.input-field, input[type="number"]');
            inputFields.forEach(field => {
                field.style.transition = 'all 0.3s ease';
                field.style.borderColor = 'var(--header-color)';
                field.style.boxShadow = '0 0 8px rgba(244, 67, 54, 0.3)';
                setTimeout(() => {
                    field.style.borderColor = '';
                    field.style.boxShadow = '';
                }, 600);
            });

            if (validateInputs()) {
                updateChart();
                updateResultDisplays();
                calculateResult();
            }
        }

        // Real-time input updates with debouncing
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', debounce(calculateWithFeedback, 250));
        });

        // Add event listeners for chart options with animations
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const precisionSelect = document.getElementById('precision');
                const chartRangeSelect = document.getElementById('chartRange');
                
                if (precisionSelect) {
                    precisionSelect.addEventListener('change', function() {
                        // Add ripple effect to precision change
                        this.style.transform = 'scale(1.1)';
                        this.style.background = 'rgba(231, 76, 60, 0.2)';
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                            this.style.background = '';
                        }, 300);
                        
                        debounce(calculateWithFeedback, 250)();
                    });
                }
                
                if (chartRangeSelect) {
                    chartRangeSelect.addEventListener('change', function() {
                        // Add ripple effect to range change
                        this.style.transform = 'scale(1.1)';
                        this.style.background = 'rgba(231, 76, 60, 0.2)';
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                            this.style.background = '';
                        }, 300);
                        
                        debounce(calculateWithFeedback, 250)();
                    });
                }
            }, 100);
        });

        // Enhanced animation trigger for option changes
        function animateChartUpdate() {
            // Create a wave effect across all visible charts
            const visibleCharts = document.querySelectorAll('.tab-content.active [id$="Chart"]');
            visibleCharts.forEach((chart, index) => {
                setTimeout(() => {
                    chart.style.transform = 'scale(0.95)';
                    chart.style.opacity = '0.7';
                    setTimeout(() => {
                        chart.style.transform = 'scale(1)';
                        chart.style.opacity = '1';
                    }, 200);
                }, index * 100);
            });
        }

        // Tab switching functionality
        function switchTab(tabName, clickedElement) {
            const tabElement = clickedElement || event?.target || document.querySelector(`.tab[onclick*="${tabName}"]`);

            if (!tabElement) {
                console.error('Tab element not found for:', tabName);
                return;
            }

            // Add switching animation to the clicked tab
            tabElement.classList.add('switching');
            setTimeout(() => {
                tabElement.classList.remove('switching');
            }, 800);

            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content with delay for smooth transition
            setTimeout(() => {
                document.getElementById(tabName + 'Tab').classList.add('active');
                tabElement.classList.add('active');

                // Trigger chart animations when switching tabs
                setTimeout(() => {
                    triggerChartAnimations(tabName);
                }, 300);
            }, 100);
        }

        function triggerChartAnimations(tabName) {
            // Add dramatic entrance animations for tab switching
            const activeChart = document.querySelector('.tab-content.active [id$="Chart"]');
            if (activeChart) {
                // Slide in from right effect
                activeChart.style.transform = 'translateX(30px)';
                activeChart.style.opacity = '0';
                
                setTimeout(() => {
                    activeChart.style.transform = 'translateX(0)';
                    activeChart.style.opacity = '1';
                }, 100);
            }
            
            // Force chart redraw with animations
            switch(tabName) {
                case 'pdf':
                    if (pdfChart) {
                        // Add bounce-in effect for PMF
                        setTimeout(() => {
                            updateChart();
                            if (pdfChart.series[0]) {
                                pdfChart.series[0].update({
                                    animation: {
                                        duration: 1200,
                                        easing: 'easeOutBounce'
                                    }
                                });
                            }
                        }, 200);
                    }
                    break;
                case 'cdf':
                    if (cdfChart) {
                        // Add smooth wave effect for CDF
                        setTimeout(() => {
                            updateChart();
                            if (cdfChart.series[0]) {
                                cdfChart.series[0].update({
                                    animation: {
                                        duration: 1000,
                                        easing: 'easeInOutSine'
                                    }
                                });
                            }
                        }, 200);
                    }
                    break;
                case 'both':
                    if (combinedChart) {
                        // Add staggered entrance for combined view
                        setTimeout(() => {
                            updateChart();
                            if (combinedChart.series[0]) {
                                combinedChart.series[0].update({
                                    animation: {
                                        duration: 800,
                                        easing: 'easeOutQuart'
                                    }
                                });
                            }
                            setTimeout(() => {
                                if (combinedChart.series[1]) {
                                    combinedChart.series[1].update({
                                        animation: {
                                            duration: 1000,
                                            easing: 'easeOutBack'
                                        }
                                    });
                                }
                            }, 300);
                        }, 200);
                    }
                    break;
            }
        }

        // Chart instances
        let pdfChart, cdfChart, combinedChart;

        // Popup functions
        function showInfoPopup() {
            document.getElementById('infoPopup').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function hideInfoPopup() {
            document.getElementById('infoPopup').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Initialize charts
        function initializeCharts() {
            if (typeof Highcharts === 'undefined') {
                console.error('Highcharts not loaded');
                return;
            }

            // Set dark theme for all charts
            Highcharts.setOptions({
                chart: {
                    backgroundColor: 'transparent',
                    style: {
                        fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif'
                    }
                },
                colors: ['#f44336', '#27ae60', '#e74c3c', '#f39c12', '#9b59b6'],
                title: {
                    style: {
                        color: 'white'
                    }
                },
                xAxis: {
                    gridLineColor: 'rgba(255,255,255,0.1)',
                    lineColor: 'rgba(255,255,255,0.3)',
                    tickColor: 'rgba(255,255,255,0.3)',
                    labels: {
                        style: {
                            color: 'white'
                        }
                    },
                    title: {
                        style: {
                            color: 'white'
                        }
                    }
                },
                yAxis: {
                    gridLineColor: 'rgba(255,255,255,0.1)',
                    lineColor: 'rgba(255,255,255,0.3)',
                    tickColor: 'rgba(255,255,255,0.3)',
                    labels: {
                        style: {
                            color: 'white'
                        }
                    },
                    title: {
                        style: {
                            color: 'white'
                        }
                    }
                },
                legend: {
                    itemStyle: {
                        color: 'white'
                    }
                },
                plotOptions: {
                    column: {
                        marker: {
                            enabled: false
                        }
                    }
                }
            });

            // PMF Chart
            pdfChart = Highcharts.chart('pdfChart', {
                chart: {
                    type: 'column',
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                },
                title: {
                    text: null
                },
                xAxis: {
                    title: {
                        text: 'Number of Successes (k)'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Probability'
                    },
                    min: 0
                },
                series: [{
                    name: 'PMF',
                    data: [],
                    color: '#f44336',
                    borderWidth: 0
                }, {
                    name: 'Highlighted',
                    data: [],
                    color: 'rgba(244, 67, 54, 0.4)',
                    borderWidth: 0
                }],
                tooltip: {
                    shared: true,
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    style: {
                        color: 'white'
                    }
                },
                credits: {
                    enabled: false
                },
                exporting: {
                    enabled: false
                }
            });

            // CDF Chart
            cdfChart = Highcharts.chart('cdfChart', {
                chart: {
                    type: 'line',
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                },
                title: {
                    text: null
                },
                xAxis: {
                    title: {
                        text: 'Number of Successes (k)'
                    }
                },
                yAxis: {
                    title: {
                        text: 'P(X ≤ k)'
                    },
                    min: 0,
                    max: 1
                },
                series: [{
                    name: 'CDF',
                    data: [],
                    color: '#27ae60',
                    lineWidth: 3,
                    shadow: true
                }],
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    style: {
                        color: 'white'
                    }
                },
                credits: {
                    enabled: false
                },
                exporting: {
                    enabled: false
                }
            });

            // Combined Chart
            combinedChart = Highcharts.chart('combinedChart', {
                chart: {
                    type: 'line',
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                },
                title: {
                    text: null
                },
                xAxis: {
                    title: {
                        text: 'Number of Successes (k)'
                    }
                },
                yAxis: [{
                    title: {
                        text: 'PMF',
                        style: {
                            color: '#f44336'
                        }
                    },
                    min: 0,
                    labels: {
                        style: {
                            color: '#f44336'
                        }
                    }
                }, {
                    title: {
                        text: 'CDF',
                        style: {
                            color: '#27ae60'
                        }
                    },
                    min: 0,
                    max: 1,
                    opposite: true,
                    labels: {
                        style: {
                            color: '#27ae60'
                        }
                    }
                }],
                series: [{
                    name: 'PMF',
                    data: [],
                    color: '#f44336',
                    type: 'column',
                    yAxis: 0
                }, {
                    name: 'CDF',
                    data: [],
                    color: '#27ae60',
                    lineWidth: 3,
                    type: 'line',
                    yAxis: 1
                }],
                tooltip: {
                    shared: true,
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    style: {
                        color: 'white'
                    }
                },
                credits: {
                    enabled: false
                },
                exporting: {
                    enabled: false
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            updateChart();
            updateStatistics(50, 20, 10);
            // Calculate initial result with default values
            calculateResult();
        });
    </script>

    <!-- Info Popup Modal -->
    <div class="popup-overlay" id="infoPopup" onclick="hideInfoPopup()">
        <div class="popup-modal" onclick="event.stopPropagation()">
            <div class="popup-header">
                <h3 class="popup-title"><i class="fas fa-info-circle"></i> About the Hypergeometric Distribution</h3>
                <button class="popup-close" onclick="hideInfoPopup()">×</button>
            </div>
            <div class="popup-content">
                <p>The Hypergeometric distribution models the probability of drawing a specific number of successes from a finite population without replacement. Common applications include:</p>
                <ul>
                    <li>Quality control: defective items in a batch</li>
                    <li>Card games: specific cards in a hand</li>
                    <li>Survey sampling: demographics in a sample</li>
                    <li>Genetics: allele frequencies in populations</li>
                </ul>
                
                <div class="popup-formula">
                    <strong>Probability Mass Function:</strong><br>
                    P(X = k) = [C(K,k) × C(N-K,n-k)] / C(N,n)<br><br>
                    <strong>Where:</strong><br>
                    • N = population size<br>
                    • K = number of success states in population<br>
                    • n = number of draws (sample size)<br>
                    • k = number of observed successes<br>
                    • C(a,b) = binomial coefficient "a choose b"<br><br>
                    <strong>Mean:</strong> μ = n × (K/N)<br>
                    <strong>Variance:</strong> σ² = n × (K/N) × (1-K/N) × (N-n)/(N-1)
                </div>
            </div>
        </div>
    </div>
</body>
</html> 